<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ch√° de Casa Nova ‚Äì Juliana & Matheus</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Questrial&display=swap" rel="stylesheet" />

  <style>
    body { box-sizing: border-box; }
    .font-heading { font-family: "Cormorant Garamond", Georgia, serif; }
    .font-body { font-family: "Questrial", sans-serif; }

    .hero-pattern {
      background-image:
        radial-gradient(ellipse at 20% 80%, rgba(195, 177, 160, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(168, 195, 160, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(210, 180, 140, 0.15) 0%, transparent 70%);
    }

    .card-hover { transition: all 0.25s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.08); }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeInUp 0.5s ease forwards; }

    .toast { animation: slideIn 0.25s ease, fadeOut 0.25s ease 2.7s forwards; }
    @keyframes slideIn { from { transform: translateY(-80%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

    img { max-width: 100%; height: auto; }

    /* Modal */
    .modal-backdrop { background: rgba(0,0,0,0.35); }

    /* small helper */
    .hint { color:#8b7355; font-size:12px; }
  </style>
</head>

<body class="h-full font-body">
  <div id="app-wrapper" class="w-full h-full overflow-auto" style="background-color:#faf8f5">

    <!-- Toast -->
    <div id="toast-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>

    <!-- MODAL RESERVA/CANCELAMENTO -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center px-4">
      <div class="absolute inset-0 modal-backdrop" onclick="closeModal()"></div>

      <div class="relative w-full max-w-lg rounded-2xl shadow-xl p-6 md:p-8" style="background:#fff; border:1px solid #EDE9E3;">
        <div class="flex items-start justify-between gap-4">
          <div>
            <div id="modal-title" class="font-heading text-3xl md:text-4xl" style="color:#5d4e37">Reservar item</div>
            <div id="modal-subtitle" class="text-sm mt-1" style="color:#8b7355"></div>
          </div>
          <button onclick="closeModal()" class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center">‚úï</button>
        </div>

        <div class="mt-6 flex items-center gap-4">
          <div id="modal-icon" class="w-16 h-16 rounded-xl overflow-hidden bg-gray-50 flex items-center justify-center"></div>
          <div>
            <div id="modal-item-name" class="font-heading text-2xl" style="color:#5d4e37"></div>
            <div id="modal-item-desc" class="text-sm" style="color:#8b7355"></div>
          </div>
        </div>

        <!-- FORM RESERVA -->
        <div id="form-reserve" class="mt-6">
          <label class="block text-sm mb-2" style="color:#5d4e37">Seu nome</label>
          <input id="input-name" type="text" class="w-full px-4 py-3 rounded-xl border" style="border-color:#EDE9E3" placeholder="Ex: Maria Silva" />

          <label class="block text-sm mt-4 mb-2" style="color:#5d4e37">Data de nascimento</label>
          <input id="input-birth" type="text" inputmode="numeric" autocomplete="bday" maxlength="10"
                 class="w-full px-4 py-3 rounded-xl border" style="border-color:#EDE9E3"
                 placeholder="DD/MM/AAAA" />
          <div class="hint mt-2">Voc√™ pode digitar s√≥ n√∫meros. Ex: 15041998 ‚Üí vira 15/04/1998 automaticamente.</div>

          <button id="btn-confirm-reserve" onclick="confirmReserve()" class="mt-5 w-full px-6 py-4 rounded-full text-white font-medium transition-all hover:shadow-lg"
            style="background-color:#6b9b5e">
            Confirmar reserva
          </button>

          <p class="text-xs mt-3" style="color:#8b7355">
            *A data de nascimento √© usada para permitir o cancelamento da sua pr√≥pria reserva depois.
          </p>
        </div>

        <!-- FORM CANCEL -->
        <div id="form-cancel" class="hidden mt-6">
          <div class="p-4 rounded-xl mb-4" style="background:#faf8f5; border:1px solid #EDE9E3;">
            <div class="text-sm" style="color:#5d4e37">
              Este item est√° reservado por <strong id="cancel-who"></strong>.
            </div>
          </div>

          <label class="block text-sm mb-2" style="color:#5d4e37">Para cancelar, confirme a data de nascimento usada na reserva</label>
          <input id="input-cancel-birth" type="text" inputmode="numeric" maxlength="10"
                 class="w-full px-4 py-3 rounded-xl border" style="border-color:#EDE9E3"
                 placeholder="DD/MM/AAAA" />
          <div class="hint mt-2">Pode digitar s√≥ n√∫meros tamb√©m. Ex: 15041998.</div>

          <button id="btn-confirm-cancel" onclick="confirmCancel()" class="mt-5 w-full px-6 py-4 rounded-full text-white font-medium transition-all hover:shadow-lg"
            style="background-color:#8b7355">
            Cancelar reserva
          </button>

          <p class="text-xs mt-3" style="color:#8b7355">
            *Se a data n√£o bater, o cancelamento n√£o ser√° permitido.
          </p>
        </div>

        <div class="mt-6">
          <a id="modal-buy-link" href="#" target="_blank" rel="noopener noreferrer"
            class="inline-flex items-center justify-center w-full px-6 py-4 rounded-full font-medium transition-all hover:shadow-md"
            style="background:#ede9e3; color:#5d4e37">
            Comprar online (opcional)
          </a>
        </div>
      </div>
    </div>

    <!-- HERO -->
    <section class="hero-pattern min-h-screen flex flex-col items-center justify-center px-6 py-16 relative overflow-hidden">
      <div class="text-center max-w-2xl mx-auto animate-fade-in">
        <p class="text-base md:text-lg tracking-[0.3em] uppercase mb-4" style="color:#6b9b5e">Ch√° de Casa Nova</p>

        <div class="flex justify-center mb-6">
          <img
            src="https://i.pinimg.com/736x/4a/6c/aa/4a6caa8efc074ac29335bff3410e8f7c.jpg"
            alt="Juliana & Matheus"
            class="w-56 md:w-72 rounded-2xl shadow-md"
            loading="lazy"
          />
        </div>

        <h1 class="font-heading text-6xl md:text-7xl lg:text-8xl font-medium mb-6 leading-tight" style="color:#5d4e37">
          Juliana & Matheus
        </h1>
        <p class="text-2xl md:text-3xl lg:text-4xl font-heading italic mb-8" style="color:#8b7355">
          Um novo lar, um novo come√ßo
        </p>

        <!-- Countdown -->
        <div class="mb-8 p-6 rounded-2xl" style="background-color:rgba(255,255,255,0.7); backdrop-filter: blur(10px)">
          <p class="text-sm tracking-[0.2em] uppercase mb-4" style="color:#6b9b5e">‚è∞ Faltam</p>
          <div id="countdown" class="flex justify-center gap-3 md:gap-6 mb-4">
            <div class="text-center">
              <div id="countdown-days" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Dias</div>
            </div>
            <div class="font-heading text-3xl md:text-5xl" style="color:#6b9b5e">:</div>
            <div class="text-center">
              <div id="countdown-hours" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Horas</div>
            </div>
            <div class="font-heading text-3xl md:text-5xl" style="color:#6b9b5e">:</div>
            <div class="text-center">
              <div id="countdown-minutes" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Min</div>
            </div>
            <div class="font-heading text-3xl md:text-5xl" style="color:#6b9b5e">:</div>
            <div class="text-center">
              <div id="countdown-seconds" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Seg</div>
            </div>
          </div>
          <p class="font-heading text-2xl md:text-3xl font-medium" style="color:#5d4e37">
            üìÖ 08 de Fevereiro de 2026 ‚Ä¢ 15h
          </p>
        </div>

        <div class="mb-8 p-3 rounded-xl" style="background-color:rgba(107,155,94,0.1); border:1px dashed #6b9b5e">
          <p class="text-base md:text-lg text-center" style="color:#5d4e37">
            üìç <strong>Sal√£o Torre Rubi</strong> ‚Äì Cond. Side Barra Funda ‚Ä¢ Rua do Bosque, 980
          </p>
        </div>

        <a href="#lista" class="inline-flex items-center gap-2 px-8 py-4 rounded-full text-white font-medium transition-all hover:shadow-lg hover:scale-105" style="background-color:#6b9b5e">
          <span>Ver Lista de Presentes</span>
          <span>‚Üì</span>
        </a>
      </div>
    </section>

    <!-- LISTA -->
    <section id="lista" class="py-20 px-6" style="background-color:#f5f2ed">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-10">
          <span class="text-4xl mb-4 block">üéÅ</span>
          <h2 class="font-heading text-4xl md:text-5xl mb-4" style="color:#5d4e37">Lista de Presentes</h2>
          <p class="text-lg md:text-xl" style="color:#8b7355">Clique em um item para reservar</p>
          <p id="sync-status" class="text-sm mt-3" style="color:#8b7355">üîÑ Preparando lista...</p>
        </div>

        <div class="flex flex-wrap justify-center gap-3 mb-12">
          <button onclick="filterCategory('all')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="all"
            style="background-color:#6b9b5e; color:white">Todos</button>
          <button onclick="filterCategory('utensilios')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="utensilios"
            style="background-color:#ede9e3; color:#5d4e37">ü•Ñ Utens√≠lios</button>
          <button onclick="filterCategory('potes')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="potes"
            style="background-color:#ede9e3; color:#5d4e37">ü´ô Potes</button>
          <button onclick="filterCategory('cozinha')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="cozinha"
            style="background-color:#ede9e3; color:#5d4e37">üç≥ Cozinha</button>
          <button onclick="filterCategory('formas')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="formas"
            style="background-color:#ede9e3; color:#5d4e37">üéÇ Formas</button>
          <button onclick="filterCategory('banheiro')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="banheiro"
            style="background-color:#ede9e3; color:#5d4e37">üõÅ Banheiro</button>
          <button onclick="filterCategory('organizacao')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="organizacao"
            style="background-color:#ede9e3; color:#5d4e37">üß∫ Organiza√ß√£o</button>
        </div>

        <div id="gift-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </section>

    <!-- COMPRAR ONLINE -->
    <section id="links" class="py-20 px-6" style="background-color:#f5f2ed">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <span class="text-4xl mb-4 block">üõíüõçÔ∏è</span>
          <h2 class="font-heading text-4xl md:text-5xl mb-4" style="color:#5d4e37">Comprar Online</h2>
          <p class="text-xl md:text-2xl" style="color:#8b7355">Caso prefira comprar online, voc√™ encontra o link de cada item aqui:</p>
        </div>
        <div id="links-list" class="space-y-3"></div>
      </div>
    </section>

    <footer class="py-16 px-6 text-center" style="background-color:#ffffff">
      <div class="max-w-2xl mx-auto">
        <div class="mb-6"><span class="text-5xl">üíö</span></div>
        <p class="font-heading text-2xl md:text-3xl mb-6 italic" style="color:#5d4e37">
          Obrigado por fazer parte desse momento t√£o especial. Cada gesto de carinho significa muito para n√≥s!
        </p>
        <p class="font-heading text-xl md:text-2xl" style="color:#8b7355">Com carinho,</p>
        <p class="font-heading text-3xl md:text-4xl mt-2" style="color:#5d4e37">Juliana & Matheus</p>
      </div>
    </footer>

  </div>

  <script>
    // ============================
    // CONFIG
    // ============================
    var APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxayYFf7S6Ug0H74f5pnIQwQL-VIuOiT_QFzqU62bP5I_dUNDiK_0UoZullNcphlyrvHg/exec";

    var config = {
      text_color: "#5D4E37",
      primary_action_color: "#6B9B5E",
      secondary_action_color: "#8B7355"
    };

    // ============================
    // ITENS (EXATAMENTE como voc√™ colou: imagem + link)
    // ============================
    var giftItems = [
      // Utens√≠lios
      { id:"utensilios-01", category:"utensilios", icon:"https://m.media-amazon.com/images/I/51wOKTjJouL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Colher de pau (kit)", description:"", link:"https://www.amazon.com.br/s?k=colher+de+pau+kit" },
      { id:"utensilios-02", category:"utensilios", icon:"https://ph-cdn3.ecosweb.com.br/imagens01/foto/utilidades-domesticas/talheres/kit-para-molho-com-concha-e-escumadeira-em-inox_140885_600_1.jpg", name:"Kit Concha e Escumadeira", description:"", link:"https://www.amazon.com.br/s?k=kit+concha+escumadeira+inox" },
      { id:"utensilios-03", category:"utensilios", icon:"https://i.pinimg.com/736x/0e/d0/be/0ed0bed0a8d2e82a0cdbe18d1a2e5a43.jpg", name:"Kit Pegador de Macarr√£o e Colher de Servir", description:"", link:"https://www.amazon.com.br/s?k=pegador+macarrao+colher+servir" },
      { id:"utensilios-04", category:"utensilios", icon:"https://m.media-amazon.com/images/I/412rlg5x9LL._AC_SL1000_.jpg", name:"Escorredor de Massa", description:"", link:"https://www.amazon.com.br/s?k=escorredor+de+massa" },
      { id:"utensilios-05", category:"utensilios", icon:"https://m.media-amazon.com/images/I/611BlzyhyAL._AC_SX679_.jpg", name:"Ralador multifuncional", description:"", link:"https://www.amazon.com.br/s?k=ralador+multifuncional" },
      { id:"utensilios-06", category:"utensilios", icon:"https://m.media-amazon.com/images/I/71+mE5Aqy9L._AC_SX679_.jpg", name:"T√°bua de corte", description:"", link:"https://www.amazon.com.br/s?k=tabua+de+corte" },
      { id:"utensilios-07", category:"utensilios", icon:"https://m.media-amazon.com/images/I/511XcDy06PL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Luva t√©rmica", description:"", link:"https://www.amazon.com.br/s?k=luva+termica+cozinha" },
      { id:"utensilios-08", category:"utensilios", icon:"https://m.media-amazon.com/images/I/71SY5kje0zL._AC_SX679_.jpg", name:"Descanso de panela", description:"", link:"https://www.amazon.com.br/s?k=descanso+de+panela" },
      { id:"utensilios-09", category:"utensilios", icon:"https://m.media-amazon.com/images/I/51Byq+vTy1L._AC_SX679_.jpg", name:"Tesoura para cozinha", description:"", link:"https://www.amazon.com.br/s?k=tesoura+cozinha" },
      { id:"utensilios-10", category:"utensilios", icon:"https://m.media-amazon.com/images/I/6155SEJ3rAL._AC_SX679_.jpg", name:"Faca para p√£o", description:"", link:"https://www.amazon.com.br/s?k=faca+para+pao" },
      { id:"utensilios-11", category:"utensilios", icon:"https://m.media-amazon.com/images/I/31fl2APEMIL._AC_SX679_.jpg", name:"Faca para carne", description:"", link:"https://www.amazon.com.br/s?k=faca+para+carne" },
      { id:"utensilios-12", category:"utensilios", icon:"https://m.media-amazon.com/images/I/31YNXnO2m2L._AC_.jpg", name:"Esp√°tula para bolo", description:"", link:"https://www.amazon.com.br/s?k=espatula+para+bolo" },
      { id:"utensilios-13", category:"utensilios", icon:"https://m.media-amazon.com/images/I/51sHeZrOspL._SX522_.jpg", name:"Pegador de sorvete em inox", description:"", link:"https://www.amazon.com.br/s?k=pegador+de+sorvete+inox" },
      { id:"utensilios-14", category:"utensilios", icon:"https://m.media-amazon.com/images/I/51ER0CKJZML._AC_SX679_.jpg", name:"Jogo de esp√°tulas para pat√™", description:"", link:"https://www.amazon.com.br/s?k=espatula+para+pate" },
      { id:"utensilios-15", category:"utensilios", icon:"https://m.media-amazon.com/images/I/51+kZPH9VsL._AC_SX679_.jpg", name:"Kit utens√≠lios de cozinha em silicone", description:"", link:"https://www.amazon.com.br/s?k=kit+utensilios+silicone" },
      { id:"utensilios-16", category:"utensilios", icon:"https://m.media-amazon.com/images/I/41NGbbQo5CL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Colher medidora (kit simples)", description:"", link:"https://www.amazon.com.br/s?k=colher+medidora+kit" },

      // Potes
      { id:"potes-01", category:"potes", icon:"https://m.media-amazon.com/images/I/51G655iyvdL._AC_SL1080_.jpg", name:"Kit 2 Potes de Vidro Herm√©ticos (op√ß√£o 1)", description:"", link:"https://a.co/d/gH9mf9o" },
      { id:"potes-02", category:"potes", icon:"https://m.media-amazon.com/images/I/51G655iyvdL._AC_SL1080_.jpg", name:"Kit 2 Potes de Vidro Herm√©ticos (op√ß√£o 2)", description:"", link:"https://a.co/d/gH9mf9o" },
      { id:"potes-03", category:"potes", icon:"https://m.media-amazon.com/images/I/51G655iyvdL._AC_SL1080_.jpg", name:"Kit 2 Potes de Vidro Herm√©ticos (op√ß√£o 3)", description:"", link:"https://a.co/d/gH9mf9o" },

      { id:"potes-04", category:"potes", icon:"https://m.media-amazon.com/images/I/51tohHGnQhL._AC_SX679_.jpg", name:"Pote Herm√©tico 1,5L (op√ß√£o 1)", description:"", link:"https://www.mercadolivre.com.br/pote-hermetico-porta-mantimentos-empilhavel-vedado-15l/p/MLB22726917" },
      { id:"potes-05", category:"potes", icon:"https://m.media-amazon.com/images/I/51tohHGnQhL._AC_SX679_.jpg", name:"Pote Herm√©tico 1,5L (op√ß√£o 2)", description:"", link:"https://www.mercadolivre.com.br/pote-hermetico-porta-mantimentos-empilhavel-vedado-15l/p/MLB22726917" },
      { id:"potes-06", category:"potes", icon:"https://m.media-amazon.com/images/I/51tohHGnQhL._AC_SX679_.jpg", name:"Pote Herm√©tico 1,5L (op√ß√£o 3)", description:"", link:"https://www.mercadolivre.com.br/pote-hermetico-porta-mantimentos-empilhavel-vedado-15l/p/MLB22726917" },
      { id:"potes-07", category:"potes", icon:"https://m.media-amazon.com/images/I/51tohHGnQhL._AC_SX679_.jpg", name:"Pote Herm√©tico 1,5L (op√ß√£o 4)", description:"", link:"https://www.mercadolivre.com.br/pote-hermetico-porta-mantimentos-empilhavel-vedado-15l/p/MLB22726917" },

      { id:"potes-08", category:"potes", icon:"https://americanas.vtexassets.com/arquivos/ids/450651-1280-auto/2521891574_1SZ.webp", name:"Conjunto 4 Potes Herm√©ticos 250ml", description:"", link:"https://www.americanas.com.br/conjunto-de-4-potes-hermeticos-retangular-250ml-leve-4-pague-3-dup-2521891566/p" },
      { id:"potes-09", category:"potes", icon:"https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcQ8BmqBG-obN7wY4VqwUNHEK48EzoXP9TnJyTVtL-7ShJ0FmfSkIQRLCTmvarQnqcjowwFYL-oz-YHhGqeS7a84VJr9id20vHW4X_n_dxfZ210_TZkD0Ura", name:"Conjunto 4 Potes Herm√©ticos 500ml", description:"", link:"https://www.americanas.com.br/conjunto-4-potes-hermeticos-essencial-cristal-l4p3-500ml-dup/p" },
      { id:"potes-10", category:"potes", icon:"https://m.media-amazon.com/images/I/61ecJ487YgL._AC_SX679_.jpg", name:"Kit Potes Herm√©ticos Redondos", description:"", link:"https://a.co/d/32dXOwk" },

      // Cozinha
      { id:"cozinha-01", category:"cozinha", icon:"https://m.media-amazon.com/images/I/71jNQBr4mbL._AC_SX679_.jpg", name:"Jarra de vidro", description:"", link:"https://www.amazon.com.br/s?k=jarra+de+vidro" },
      { id:"cozinha-02", category:"cozinha", icon:"https://m.media-amazon.com/images/I/51d+B8zoAvL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Leiteira", description:"", link:"https://www.amazon.com.br/s?k=leiteira+inox" },
      { id:"cozinha-03", category:"cozinha", icon:"https://m.media-amazon.com/images/I/31TpUxJ4mHL._AC_SX679_.jpg", name:"Coador de caf√© Melitta 103", description:"", link:"https://www.amazon.com.br/s?k=coador+cafe+melitta+103" },
      { id:"cozinha-04", category:"cozinha", icon:"https://m.media-amazon.com/images/I/61+LfzcEVGL._AC_SX679_.jpg", name:"Kit peneiras em inox", description:"", link:"https://www.amazon.com.br/s?k=kit+peneiras+inox" },
      { id:"cozinha-05", category:"cozinha", icon:"https://m.media-amazon.com/images/I/41lQvVjbepL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Saladeira", description:"", link:"https://www.amazon.com.br/s?k=saladeira" },
      { id:"cozinha-06", category:"cozinha", icon:"https://m.media-amazon.com/images/I/41BvG7PiFGL._AC_SX679_.jpg", name:"Bowl de vidro grande", description:"", link:"https://www.amazon.com.br/s?k=bowl+vidro+grande" },
      { id:"cozinha-07", category:"cozinha", icon:"https://m.media-amazon.com/images/I/51lCJHAgXSL._AC_SX679_.jpg", name:"Porta-guardanapo em inox", description:"", link:"https://www.amazon.com.br/s?k=porta+guardanapo+inox" },
      { id:"cozinha-08", category:"cozinha", icon:"https://m.media-amazon.com/images/I/61xTgzfTp1L._AC_SX679_.jpg", name:"Saleiro e pimenteiro", description:"", link:"https://www.amazon.com.br/s?k=saleiro+pimenteiro" },
      { id:"cozinha-09", category:"cozinha", icon:"https://m.media-amazon.com/images/I/61vFMvBrCcL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Petisqueira 1", description:"", link:"https://www.amazon.com.br/s?k=petisqueira" },
      { id:"cozinha-10", category:"cozinha", icon:"https://m.media-amazon.com/images/I/41sABmlWy5L._AC_SX679_.jpg", name:"Petisqueira 2", description:"", link:"https://www.amazon.com.br/s?k=petisqueira" },
      { id:"cozinha-11", category:"cozinha", icon:"https://m.media-amazon.com/images/I/41fnZrY2myL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Jogo de x√≠caras de caf√© (6 unidades)", description:"", link:"https://www.amazon.com.br/s?k=jogo+xicaras+cafe" },

      // Formas
      { id:"formas-01", category:"formas", icon:"https://m.media-amazon.com/images/I/31DgHfr0lkL._AC_.jpg", name:"Forma de bolo redonda", description:"", link:"https://www.amazon.com.br/s?k=forma+bolo+redonda" },
      { id:"formas-02", category:"formas", icon:"https://m.media-amazon.com/images/I/614ntxPcIsL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Forma de bolo com furo", description:"", link:"https://www.amazon.com.br/s?k=forma+bolo+furo" },
      { id:"formas-03", category:"formas", icon:"https://m.media-amazon.com/images/I/51cQ4Rp1B8L._AC_SX679_.jpg", name:"Forma retangular m√©dia (bolo/brownie)", description:"", link:"https://www.amazon.com.br/s?k=forma+retangular+bolo" },
      { id:"formas-04", category:"formas", icon:"https://m.media-amazon.com/images/I/51h2IHO3cJS._AC_SX679_.jpg", name:"Forma de lasanha de vidro", description:"", link:"https://www.amazon.com.br/s?k=forma+lasanha+vidro" },
      { id:"formas-05", category:"formas", icon:"https://m.media-amazon.com/images/I/71K7vZLMzUL._AC_SX679_.jpg", name:"Forma de pizza", description:"", link:"https://www.amazon.com.br/s?k=forma+pizza" },

      // Banheiro
      { id:"banheiro-01", category:"banheiro", icon:"https://m.media-amazon.com/images/I/51zNDiujMCL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Saboneteira", description:"", link:"https://www.amazon.com.br/s?k=saboneteira" },
      { id:"banheiro-02", category:"banheiro", icon:"https://m.media-amazon.com/images/I/61Y22+k1kAL._AC_SX679_.jpg", name:"Porta sabonete l√≠quido", description:"", link:"https://www.amazon.com.br/s?k=porta+sabonete+liquido" },
      { id:"banheiro-03", category:"banheiro", icon:"https://m.media-amazon.com/images/I/51sutAJ9eSL._AC_SY300_SX300_QL70_ML2_.jpg", name:"Escova para vaso sanit√°rio", description:"", link:"https://www.amazon.com.br/s?k=escova+vaso+sanitario" },
      { id:"banheiro-04", category:"banheiro", icon:"https://m.media-amazon.com/images/I/71ByWjXmOPL._AC_SX679_.jpg", name:"Toalha de rosto 1", description:"", link:"https://www.amazon.com.br/s?k=toalha+de+rosto" },
      { id:"banheiro-05", category:"banheiro", icon:"https://m.media-amazon.com/images/I/51Qjx9m0JEL._AC_SX679_.jpg", name:"Toalha de rosto 2", description:"", link:"https://www.amazon.com.br/s?k=toalha+de+rosto" },

      // Organiza√ß√£o
      { id:"organizacao-01", category:"organizacao", icon:"https://m.media-amazon.com/images/I/71QBq-o+bZL._AC_SX300_SY300_QL70_ML2_.jpg", name:"Cabides (kit)", description:"", link:"https://www.amazon.com.br/s?k=cabides+kit" }
    ];

    // ============================
    // STATE
    // ============================
    var reservations = [];
    var currentCategory = "all";
    var selectedItem = null;

    // ============================
    // HELPERS
    // ============================
    function $(id){ return document.getElementById(id); }

    function showToast(message, type) {
      var container = $("toast-container");
      if (!container) return;
      var toast = document.createElement("div");
      toast.className = "toast px-6 py-3 rounded-full shadow-lg text-white font-medium";
      toast.style.backgroundColor = (type === "success") ? "#6B9B5E" : "#D4A5A5";
      toast.innerHTML = message;
      container.appendChild(toast);
      setTimeout(function(){ try{ container.removeChild(toast); }catch(e){} }, 3000);
    }

    function setSyncStatus(text) {
      var el = $("sync-status");
      if (el) el.innerHTML = text;
    }

    function pad2(n) {
      n = String(n);
      return (n.length < 2) ? ("0" + n) : n;
    }

    function safeText(s) {
      s = String(s || "");
      s = s.replace(/&/g,"&amp;");
      s = s.replace(/</g,"&lt;");
      s = s.replace(/>/g,"&gt;");
      s = s.replace(/"/g,"&quot;");
      s = s.replace(/'/g,"&#039;");
      return s;
    }

    function isImageUrl(u){ return u && String(u).indexOf("http") === 0; }

    function digitsOnly(s){
      return String(s || "").replace(/[^\d]/g, "");
    }

    // Formata enquanto digita: 1504 -> 15/04, 15041998 -> 15/04/1998
    function formatDateBRPartial(raw){
      var d = digitsOnly(raw);
      if (d.length > 8) d = d.substring(0,8);

      var out = "";
      if (d.length <= 2) {
        out = d;
      } else if (d.length <= 4) {
        out = d.substring(0,2) + "/" + d.substring(2);
      } else {
        out = d.substring(0,2) + "/" + d.substring(2,4) + "/" + d.substring(4);
      }
      return out;
    }

    function isValidDateBRStrict(s){
      // dd/mm/aaaa e valida ranges b√°sicos
      s = String(s || "");
      if (!/^\d{2}\/\d{2}\/\d{4}$/.test(s)) return false;
      var dd = parseInt(s.substring(0,2),10);
      var mm = parseInt(s.substring(3,5),10);
      var yy = parseInt(s.substring(6,10),10);
      if (mm < 1 || mm > 12) return false;
      if (dd < 1 || dd > 31) return false;
      if (yy < 1900 || yy > 2100) return false;
      return true;
    }

    // Normaliza qualquer entrada (com ou sem barras) -> dd/mm/aaaa
    function normalizeBirthdate(input){
      var d = digitsOnly(input);
      if (d.length !== 8) return null;
      return d.substring(0,2) + "/" + d.substring(2,4) + "/" + d.substring(4,8);
    }

    function renderIconHtml(item) {
      if (isImageUrl(item.icon)) {
        return '<img src="'+ item.icon +'" alt="'+ safeText(item.name) +'" class="w-20 h-20 object-contain mx-auto rounded-lg" loading="lazy" onerror="this.onerror=null; this.outerHTML=\'<span class=&quot;text-4xl block&quot;>üéÅ</span>\'">';
      }
      return '<span class="text-4xl block">üéÅ</span>';
    }

    // ============================
    // JSONP (para Android antigo)
    // ============================
    function jsonpRequest(params, onOk, onErr) {
      var cbName = "__cb_" + (new Date().getTime()) + "_" + Math.floor(Math.random()*100000);
      params._ts = new Date().getTime();

      var query = [];
      for (var k in params) {
        if (params.hasOwnProperty(k)) {
          query.push(encodeURIComponent(k) + "=" + encodeURIComponent(String(params[k])));
        }
      }
      query.push("callback=" + encodeURIComponent(cbName));

      var url = APPS_SCRIPT_URL + (APPS_SCRIPT_URL.indexOf("?") >= 0 ? "&" : "?") + query.join("&");

      var done = false;
      var script = document.createElement("script");

      var timer = setTimeout(function(){
        if (done) return;
        done = true;
        cleanup();
        if (onErr) onErr({ message: "Timeout" });
      }, 15000);

      window[cbName] = function(data){
        if (done) return;
        done = true;
        cleanup();
        if (onOk) onOk(data);
      };

      function cleanup() {
        clearTimeout(timer);
        try { window[cbName] = null; } catch(e){}
        try { if (script && script.parentNode) script.parentNode.removeChild(script); } catch(e){}
      }

      script.onerror = function(){
        if (done) return;
        done = true;
        cleanup();
        if (onErr) onErr({ message: "Falha ao carregar JSONP" });
      };

      script.src = url;
      document.body.appendChild(script);
    }

    // ============================
    // RESERVAS
    // ============================
    function isReserved(itemId) {
      for (var i=0; i<reservations.length; i++) {
        if (String(reservations[i].item_id) === String(itemId)) return true;
      }
      return false;
    }

    function getReservation(itemId) {
      for (var i=0; i<reservations.length; i++) {
        if (String(reservations[i].item_id) === String(itemId)) return reservations[i];
      }
      return null;
    }

    function findItemById(itemId){
      for (var i=0; i<giftItems.length; i++){
        if (String(giftItems[i].id) === String(itemId)) return giftItems[i];
      }
      return null;
    }

    // ============================
    // MODAL
    // ============================
    function openModal(itemId){
      var item = findItemById(itemId);
      if (!item) return;

      selectedItem = item;

      $("modal-item-name").innerHTML = safeText(item.name);
      $("modal-item-desc").innerHTML = safeText(item.description || "");
      $("modal-icon").innerHTML = renderIconHtml(item);

      var a = $("modal-buy-link");
      if (item.link) {
        a.href = item.link;
        a.style.display = "inline-flex";
      } else {
        a.href = "#";
        a.style.display = "none";
      }

      var res = getReservation(item.id);
      if (!res) {
        $("modal-title").innerHTML = "Reservar item";
        $("modal-subtitle").innerHTML = "Preencha seus dados para reservar este presente.";
        $("form-reserve").className = "mt-6";
        $("form-cancel").className = "hidden mt-6";
        $("input-name").value = "";
        $("input-birth").value = "";
      } else {
        $("modal-title").innerHTML = "Cancelar reserva";
        $("modal-subtitle").innerHTML = "Cancelamento √© permitido apenas com a mesma data usada na reserva.";
        $("form-reserve").className = "hidden mt-6";
        $("form-cancel").className = "mt-6";
        $("cancel-who").innerHTML = safeText(res.reserved_by || "algu√©m");
        $("input-cancel-birth").value = "";
      }

      $("modal").className = $("modal").className.replace("hidden","").trim();
      hookDateMaskInputs(); // garante m√°scara sempre ativa
    }

    function closeModal(){
      selectedItem = null;
      var m = $("modal");
      if (!m) return;
      if (m.className.indexOf("hidden") === -1) m.className = "hidden " + m.className;
    }

    // ============================
    // M√ÅSCARA DE DATA (AUTO BARRAS)
    // ============================
    var dateMaskHooked = false;

    function hookDateMaskInputs(){
      // evita duplicar listeners
      if (dateMaskHooked) return;
      dateMaskHooked = true;

      function bind(el){
        if (!el) return;
        el.addEventListener("input", function(){
          var formatted = formatDateBRPartial(el.value);
          if (el.value !== formatted) el.value = formatted;
        });

        el.addEventListener("blur", function(){
          // no blur, se tiver 8 d√≠gitos, normaliza full
          var norm = normalizeBirthdate(el.value);
          if (norm) el.value = norm;
        });
      }

      try {
        bind($("input-birth"));
        bind($("input-cancel-birth"));
      } catch(e){}
    }

    // ============================
    // ACTIONS RESERVAR / CANCELAR
    // ============================
    function confirmReserve(){
      if (!selectedItem) return;

      var name = String($("input-name").value || "").replace(/^\s+|\s+$/g,"");
      var birthRaw = String($("input-birth").value || "");

      if (!name) { showToast("Digite seu nome.", "error"); return; }

      var birth = normalizeBirthdate(birthRaw);
      if (!birth || !isValidDateBRStrict(birth)) {
        showToast("Data inv√°lida. Use DD/MM/AAAA (pode digitar s√≥ n√∫meros).", "error");
        return;
      }

      $("input-birth").value = birth;

      $("btn-confirm-reserve").innerHTML = "Reservando...";
      $("btn-confirm-reserve").disabled = true;

      jsonpRequest(
        {
          action: "reserve",
          item_id: selectedItem.id,
          item_name: selectedItem.name,
          reserved_by: name,
          reserved_birthdate: birth
        },
        function(res){
          $("btn-confirm-reserve").innerHTML = "Confirmar reserva";
          $("btn-confirm-reserve").disabled = false;

          if (res && res.ok) {
            showToast("‚úÖ Reservado com sucesso!", "success");
            closeModal();
            fetchReservations(true);
          } else {
            showToast((res && res.message) ? res.message : "N√£o foi poss√≠vel reservar.", "error");
          }
        },
        function(){
          $("btn-confirm-reserve").innerHTML = "Confirmar reserva";
          $("btn-confirm-reserve").disabled = false;
          showToast("Falha de conex√£o ao reservar.", "error");
        }
      );
    }

    function confirmCancel(){
      if (!selectedItem) return;

      var birthRaw = String($("input-cancel-birth").value || "");
      var birth = normalizeBirthdate(birthRaw);

      if (!birth || !isValidDateBRStrict(birth)) {
        showToast("Data inv√°lida. Use DD/MM/AAAA (pode digitar s√≥ n√∫meros).", "error");
        return;
      }

      $("input-cancel-birth").value = birth;

      $("btn-confirm-cancel").innerHTML = "Cancelando...";
      $("btn-confirm-cancel").disabled = true;

      jsonpRequest(
        {
          action: "cancel",
          item_id: selectedItem.id,
          reserved_birthdate: birth
        },
        function(res){
          $("btn-confirm-cancel").innerHTML = "Cancelar reserva";
          $("btn-confirm-cancel").disabled = false;

          if (res && res.ok) {
            showToast("‚úÖ Reserva cancelada!", "success");
            closeModal();
            fetchReservations(true);
          } else {
            showToast((res && res.message) ? res.message : "N√£o foi poss√≠vel cancelar.", "error");
          }
        },
        function(){
          $("btn-confirm-cancel").innerHTML = "Cancelar reserva";
          $("btn-confirm-cancel").disabled = false;
          showToast("Falha de conex√£o ao cancelar.", "error");
        }
      );
    }

    // ============================
    // RENDER GRID
    // ============================
    function renderGiftGrid() {
      var grid = $("gift-grid");
      if (!grid) return;

      var items = [];
      for (var i=0; i<giftItems.length; i++) {
        var it = giftItems[i];
        if (currentCategory === "all" || it.category === currentCategory) items.push(it);
      }

      // dispon√≠veis primeiro
      var available = [];
      var reserved = [];
      for (var j=0; j<items.length; j++) {
        if (isReserved(items[j].id)) reserved.push(items[j]);
        else available.push(items[j]);
      }
      var sorted = available.concat(reserved);

      var html = "";
      for (var k=0; k<sorted.length; k++) {
        var item = sorted[k];
        var res = getReservation(item.id);
        var r = !!res;

        html += '<div class="card-hover rounded-2xl p-6 border-2 relative overflow-hidden" style="background-color:#fff; border-color:#EDE9E3;">';

        if (r) {
          html += '<div class="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-medium text-white" style="background-color:'+ config.secondary_action_color +'">Reservado</div>';
        } else {
          html += '<div class="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-medium text-white" style="background-color:'+ config.primary_action_color +'">Dispon√≠vel</div>';
        }

        html += '<div class="text-center">';
        html += '<div class="mb-4 flex justify-center items-center" style="min-height:80px;">'+ renderIconHtml(item) +'</div>';
        html += '<h3 class="font-heading text-2xl mb-2" style="color:'+ config.text_color +'">'+ safeText(item.name) +'</h3>';

        if (r) {
          html += '<div class="text-sm italic mb-4" style="color:#8b7355">Reservado por '+ safeText(res.reserved_by || "algu√©m") +'</div>';
          html += '<button onclick="openModal(\''+ item.id +'\')" class="w-full px-6 py-3 rounded-full text-white font-medium transition-all hover:shadow-md" style="background-color:'+ config.secondary_action_color +'">Cancelar reserva</button>';
        } else {
          html += '<div class="text-sm mb-4" style="color:#6b9b5e">‚úÖ Clique para reservar</div>';
          html += '<button onclick="openModal(\''+ item.id +'\')" class="w-full px-6 py-3 rounded-full text-white font-medium transition-all hover:shadow-md" style="background-color:'+ config.primary_action_color +'">Reservar</button>';
        }

        html += '</div></div>';
      }

      grid.innerHTML = html;
    }

    function filterCategory(cat) {
      currentCategory = cat;

      var btns = document.getElementsByClassName("category-btn");
      for (var i=0; i<btns.length; i++) {
        var btn = btns[i];
        var c = btn.getAttribute("data-category");
        if (c === cat) {
          btn.style.backgroundColor = config.primary_action_color;
          btn.style.color = "white";
        } else {
          btn.style.backgroundColor = "#EDE9E3";
          btn.style.color = config.text_color;
        }
      }

      renderGiftGrid();
    }

    // ============================
    // RENDER LINKS
    // ============================
    function renderLinksList() {
      var container = $("links-list");
      if (!container) return;

      function storeName(link) {
        link = String(link || "");
        if (link.indexOf("amazon") >= 0 || link.indexOf("a.co") >= 0) return "Ver na Amazon";
        if (link.indexOf("mercadolivre") >= 0) return "Ver no Mercado Livre";
        if (link.indexOf("americanas") >= 0) return "Ver nas Americanas";
        return "Ver loja";
      }

      // lista simples (sem separar por categoria ‚Äî fica leve e completa)
      var html = "";
      for (var i=0; i<giftItems.length; i++) {
        var it = giftItems[i];
        if (!it.link) continue;

        html += '<a href="'+ it.link +'" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-4 rounded-xl transition-all hover:shadow-md" style="background-color:white; border:1px solid #EDE9E3;">';
        html += '<div class="flex items-center gap-3">';
        html += '<div class="w-10 h-10 rounded-lg overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center">';
        html += (isImageUrl(it.icon) ? '<img src="'+ it.icon +'" class="w-full h-full object-contain" loading="lazy" onerror="this.outerHTML=\'üéÅ\'">' : 'üéÅ');
        html += '</div>';
        html += '<span class="font-medium" style="color:'+ config.text_color +'">'+ safeText(it.name) +'</span>';
        html += '</div>';
        html += '<div class="text-sm" style="color:'+ config.primary_action_color +'">'+ storeName(it.link) +'</div>';
        html += '</a>';
      }

      container.innerHTML = html;
    }

    // ============================
    // COUNTDOWN
    // ============================
    function updateCountdown() {
      try {
        var eventDate = new Date("2026-02-08T15:00:00-03:00");
        var now = new Date();
        var diff = eventDate.getTime() - now.getTime();
        if (diff <= 0) diff = 0;

        var days = Math.floor(diff / (1000*60*60*24));
        var hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
        var minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
        var seconds = Math.floor((diff % (1000*60)) / 1000);

        $("countdown-days").innerHTML = String(days);
        $("countdown-hours").innerHTML = pad2(hours);
        $("countdown-minutes").innerHTML = pad2(minutes);
        $("countdown-seconds").innerHTML = pad2(seconds);
      } catch(e) {}
    }

    // ============================
    // FETCH RESERVAS
    // ============================
    function fetchReservations(silent) {
      if (!silent) setSyncStatus("üîÑ Carregando reservas...");

      jsonpRequest(
        { action:"list" },
        function(res) {
          if (res && res.ok) {
            reservations = res.reservations || [];
            renderGiftGrid();
            if (!silent) setSyncStatus("‚úÖ Reservas atualizadas.");
          } else {
            renderGiftGrid();
            if (!silent) setSyncStatus("‚ö†Ô∏è N√£o foi poss√≠vel carregar reservas agora.");
          }
        },
        function() {
          renderGiftGrid();
          if (!silent) setSyncStatus("‚ö†Ô∏è Falha ao carregar reservas.");
        }
      );
    }

    // ============================
    // INIT
    // ============================
    function init() {
      renderLinksList();
      filterCategory("all");

      updateCountdown();
      setInterval(updateCountdown, 1000);

      // hooks da m√°scara
      hookDateMaskInputs();

      fetchReservations(false);
      setInterval(function(){ fetchReservations(true); }, 25000);

      setSyncStatus("‚úÖ Lista pronta! (reservas atualizando)");
    }

    (function(){
      if (document.readyState === "complete" || document.readyState === "interactive") {
        setTimeout(init, 1);
      } else if (document.addEventListener) {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        window.attachEvent && window.attachEvent("onload", init);
      }
    })();
  </script>
</body>
</html>
