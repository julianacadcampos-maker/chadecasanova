<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ch√° de Casa Nova ‚Äì Juliana & Matheus</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Questrial&display=swap" rel="stylesheet" />

  <style>
    body { box-sizing: border-box; }
    .font-heading { font-family: "Cormorant Garamond", Georgia, serif; }
    .font-body { font-family: "Questrial", sans-serif; }

    .hero-pattern {
      background-image:
        radial-gradient(ellipse at 20% 80%, rgba(195, 177, 160, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(168, 195, 160, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(210, 180, 140, 0.15) 0%, transparent 70%);
    }

    .card-hover { transition: all 0.25s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.08); }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeInUp 0.5s ease forwards; }

    .toast { animation: slideIn 0.25s ease, fadeOut 0.25s ease 2.7s forwards; }
    @keyframes slideIn { from { transform: translateY(-80%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

    img { max-width: 100%; height: auto; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* Modal */
    .modal-backdrop { background: rgba(0,0,0,0.35); }
  </style>
</head>

<body class="h-full font-body">
  <div id="app-wrapper" class="w-full h-full overflow-auto" style="background-color:#faf8f5">

    <!-- Toast -->
    <div id="toast-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>

    <!-- Debug -->
    <div id="debug-box" class="hidden fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-[420px] z-50 p-4 rounded-xl shadow-lg"
      style="background:#fff; border:1px solid #EDE9E3;">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="font-semibold" style="color:#5d4e37">‚ö†Ô∏è Algo deu errado no site</div>
          <div id="debug-text" class="text-sm mt-1" style="color:#8b7355"></div>
          <div class="text-xs mt-2 mono" style="color:#9a8f82" id="debug-hint"></div>
        </div>
        <button onclick="hideDebug()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">‚úï</button>
      </div>
    </div>

    <!-- MODAL RESERVA/CANCELAMENTO -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center px-4">
      <div class="absolute inset-0 modal-backdrop" onclick="closeModal()"></div>

      <div class="relative w-full max-w-lg rounded-2xl shadow-xl p-6 md:p-8" style="background:#fff; border:1px solid #EDE9E3;">
        <div class="flex items-start justify-between gap-4">
          <div>
            <div id="modal-title" class="font-heading text-3xl md:text-4xl" style="color:#5d4e37">Reservar item</div>
            <div id="modal-subtitle" class="text-sm mt-1" style="color:#8b7355"></div>
          </div>
          <button onclick="closeModal()" class="w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center">‚úï</button>
        </div>

        <div class="mt-6 flex items-center gap-4">
          <div id="modal-icon" class="w-16 h-16 rounded-xl overflow-hidden bg-gray-50 flex items-center justify-center"></div>
          <div>
            <div id="modal-item-name" class="font-heading text-2xl" style="color:#5d4e37"></div>
            <div id="modal-item-desc" class="text-sm" style="color:#8b7355"></div>
          </div>
        </div>

        <!-- FORM RESERVA -->
        <div id="form-reserve" class="mt-6">
          <label class="block text-sm mb-2" style="color:#5d4e37">Seu nome</label>
          <input id="input-name" type="text" class="w-full px-4 py-3 rounded-xl border" style="border-color:#EDE9E3" placeholder="Ex: Maria Silva" />

          <label class="block text-sm mt-4 mb-2" style="color:#5d4e37">Data de nascimento (DD/MM/AAAA)</label>
          <input id="input-birth" type="text" class="w-full px-4 py-3 rounded-xl border" style="border-color:#EDE9E3" placeholder="Ex: 15/04/1998" />

          <button id="btn-confirm-reserve" onclick="confirmReserve()" class="mt-5 w-full px-6 py-4 rounded-full text-white font-medium transition-all hover:shadow-lg"
            style="background-color:#6b9b5e">
            Confirmar reserva
          </button>

          <p class="text-xs mt-3" style="color:#8b7355">
            *A data de nascimento √© usada para permitir o cancelamento da sua pr√≥pria reserva depois.
          </p>
        </div>

        <!-- FORM CANCEL -->
        <div id="form-cancel" class="hidden mt-6">
          <div class="p-4 rounded-xl mb-4" style="background:#faf8f5; border:1px solid #EDE9E3;">
            <div class="text-sm" style="color:#5d4e37">
              Este item est√° reservado por <strong id="cancel-who"></strong>.
            </div>
          </div>

          <label class="block text-sm mb-2" style="color:#5d4e37">Para cancelar, confirme a data de nascimento usada na reserva</label>
          <input id="input-cancel-birth" type="text" class="w-full px-4 py-3 rounded-xl border" style="border-color:#EDE9E3" placeholder="DD/MM/AAAA" />

          <button id="btn-confirm-cancel" onclick="confirmCancel()" class="mt-5 w-full px-6 py-4 rounded-full text-white font-medium transition-all hover:shadow-lg"
            style="background-color:#8b7355">
            Cancelar reserva
          </button>

          <p class="text-xs mt-3" style="color:#8b7355">
            *Se a data n√£o bater, o cancelamento n√£o ser√° permitido.
          </p>
        </div>

        <div class="mt-6">
          <a id="modal-buy-link" href="#" target="_blank" rel="noopener noreferrer"
            class="inline-flex items-center justify-center w-full px-6 py-4 rounded-full font-medium transition-all hover:shadow-md"
            style="background:#ede9e3; color:#5d4e37">
            Comprar online (opcional)
          </a>
        </div>
      </div>
    </div>

    <!-- HERO -->
    <section class="hero-pattern min-h-screen flex flex-col items-center justify-center px-6 py-16 relative overflow-hidden">
      <div class="text-center max-w-2xl mx-auto animate-fade-in">
        <p class="text-base md:text-lg tracking-[0.3em] uppercase mb-4" style="color:#6b9b5e">Ch√° de Casa Nova</p>

        <div class="flex justify-center mb-6">
          <img
            src="https://i.pinimg.com/736x/4a/6c/aa/4a6caa8efc074ac29335bff3410e8f7c.jpg"
            alt="Juliana & Matheus"
            class="w-56 md:w-72 rounded-2xl shadow-md"
            loading="lazy"
          />
        </div>

        <h1 id="hero-title" class="font-heading text-6xl md:text-7xl lg:text-8xl font-medium mb-6 leading-tight" style="color:#5d4e37">
          Juliana & Matheus
        </h1>
        <p id="hero-subtitle" class="text-2xl md:text-3xl lg:text-4xl font-heading italic mb-8" style="color:#8b7355">
          Um novo lar, um novo come√ßo
        </p>

        <!-- Countdown -->
        <div class="mb-8 p-6 rounded-2xl" style="background-color:rgba(255,255,255,0.7); backdrop-filter: blur(10px)">
          <p class="text-sm tracking-[0.2em] uppercase mb-4" style="color:#6b9b5e">‚è∞ Faltam</p>
          <div id="countdown" class="flex justify-center gap-3 md:gap-6 mb-4">
            <div class="text-center">
              <div id="countdown-days" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Dias</div>
            </div>
            <div class="font-heading text-3xl md:text-5xl" style="color:#6b9b5e">:</div>
            <div class="text-center">
              <div id="countdown-hours" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Horas</div>
            </div>
            <div class="font-heading text-3xl md:text-5xl" style="color:#6b9b5e">:</div>
            <div class="text-center">
              <div id="countdown-minutes" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Min</div>
            </div>
            <div class="font-heading text-3xl md:text-5xl" style="color:#6b9b5e">:</div>
            <div class="text-center">
              <div id="countdown-seconds" class="font-heading text-3xl md:text-5xl font-semibold" style="color:#5d4e37">--</div>
              <div class="text-xs md:text-sm uppercase tracking-wider" style="color:#8b7355">Seg</div>
            </div>
          </div>
          <p class="font-heading text-2xl md:text-3xl font-medium" style="color:#5d4e37">
            üìÖ 08 de Fevereiro de 2026 ‚Ä¢ 15h
          </p>
        </div>

        <div class="mb-8 p-3 rounded-xl" style="background-color:rgba(107,155,94,0.1); border:1px dashed #6b9b5e">
          <p class="text-base md:text-lg text-center" style="color:#5d4e37">
            üìç <strong>Sal√£o Torre Rubi</strong> ‚Äì Cond. Side Barra Funda ‚Ä¢ Rua do Bosque, 980
          </p>
        </div>

        <a href="#lista" class="inline-flex items-center gap-2 px-8 py-4 rounded-full text-white font-medium transition-all hover:shadow-lg hover:scale-105" style="background-color:#6b9b5e">
          <span>Ver Lista de Presentes</span>
          <span>‚Üì</span>
        </a>
      </div>
    </section>

    <!-- LISTA -->
    <section id="lista" class="py-20 px-6" style="background-color:#f5f2ed">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-10">
          <span class="text-4xl mb-4 block">üéÅ</span>
          <h2 class="font-heading text-4xl md:text-5xl mb-4" style="color:#5d4e37">Lista de Presentes</h2>
          <p class="text-lg md:text-xl" style="color:#8b7355">Clique em um item para reservar</p>
          <p id="sync-status" class="text-sm mt-3" style="color:#8b7355">üîÑ Preparando lista...</p>
        </div>

        <div class="flex flex-wrap justify-center gap-3 mb-12">
          <button onclick="filterCategory('all')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="all"
            style="background-color:#6b9b5e; color:white">Todos</button>
          <button onclick="filterCategory('utensilios')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="utensilios"
            style="background-color:#ede9e3; color:#5d4e37">ü•Ñ Utens√≠lios</button>
          <button onclick="filterCategory('potes')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="potes"
            style="background-color:#ede9e3; color:#5d4e37">ü´ô Potes</button>
          <button onclick="filterCategory('cozinha')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="cozinha"
            style="background-color:#ede9e3; color:#5d4e37">üç≥ Cozinha</button>
          <button onclick="filterCategory('formas')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="formas"
            style="background-color:#ede9e3; color:#5d4e37">üéÇ Formas</button>
          <button onclick="filterCategory('banheiro')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="banheiro"
            style="background-color:#ede9e3; color:#5d4e37">üõÅ Banheiro</button>
          <button onclick="filterCategory('organizacao')" class="category-btn px-6 py-3 rounded-full font-medium transition-all text-base md:text-lg" data-category="organizacao"
            style="background-color:#ede9e3; color:#5d4e37">üß∫ Organiza√ß√£o</button>
        </div>

        <div id="gift-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </section>

    <!-- COMPRAR ONLINE -->
    <section id="links" class="py-20 px-6" style="background-color:#f5f2ed">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
          <span class="text-4xl mb-4 block">üõíüõçÔ∏è</span>
          <h2 class="font-heading text-4xl md:text-5xl mb-4" style="color:#5d4e37">Comprar Online</h2>
          <p class="text-xl md:text-2xl" style="color:#8b7355">Caso prefira comprar online, voc√™ encontra o link de cada item aqui:</p>
        </div>
        <div id="links-list" class="space-y-3"></div>
      </div>
    </section>

    <footer class="py-16 px-6 text-center" style="background-color:#ffffff">
      <div class="max-w-2xl mx-auto">
        <div class="mb-6"><span class="text-5xl">üíö</span></div>
        <p class="font-heading text-2xl md:text-3xl mb-6 italic" style="color:#5d4e37">
          Obrigado por fazer parte desse momento t√£o especial. Cada gesto de carinho significa muito para n√≥s!
        </p>
        <p class="font-heading text-xl md:text-2xl" style="color:#8b7355">Com carinho,</p>
        <p class="font-heading text-3xl md:text-4xl mt-2" style="color:#5d4e37">Juliana & Matheus</p>
      </div>
    </footer>

  </div>

  <script>
    // ============================
    // CONFIG
    // ============================
    var APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyc9YOXMXk0tUGV6S4D30CSh5x7-qoJzwuExO0BGtvyg3qtk26As9gGqEzY6QBA5dddqA/exec";

    var config = {
      couple_names: "Juliana & Matheus",
      event_subtitle: "Um novo lar, um novo come√ßo",
      text_color: "#5D4E37",
      primary_action_color: "#6B9B5E",
      secondary_action_color: "#8B7355"
    };

    // ============================
    // DADOS (48 itens do arquivo original)
    // ============================
    var giftItems = [
        // Utens√≠lios de Cozinha
        { id: "utensilios-1", category: "utensilios", icon: "https://m.media-amazon.com/images/I/51wOKTjJouL._AC_SY300_SX300_QL70_ML2_.jpg", name: "Colher de pau (kit)", description: "Kit com colheres de madeira", link: "https://www.amazon.com.br/s?k=kit+colher+de+pau" },
        { id: "utensilios-2", category: "utensilios", icon: "https://ph-cdn3.ecosweb.com.br/imagens01/foto/utilidades-domesticas/talheres/kit-para-molho-com-concha-e-escumadeira-em-inox_140885_600_1.jpg", name: "Kit Concha e Escumadeira", description: "Dupla essencial para cozinhar", link: "https://www.amazon.com.br/s?k=kit+concha+escumadeira+inox" },
        { id: "utensilios-3", category: "utensilios", icon: "https://m.media-amazon.com/images/I/51tS8o+qF5L._AC_SX679_.jpg", name: "Esp√°tula de silicone", description: "Para cozinhar sem riscar panelas", link: "https://www.amazon.com.br/s?k=espatula+silicone" },
        { id: "utensilios-4", category: "utensilios", icon: "https://m.media-amazon.com/images/I/412rlg5x9LL._AC_SL1000_.jpg", name: "Escorredor de Massa", description: "Para escorrer massas com praticidade", link: "https://www.amazon.com.br/s?k=escorredor+de+massa" },
        { id: "utensilios-5", category: "utensilios", icon: "https://m.media-amazon.com/images/I/71yL0g0I6uL._AC_SX679_.jpg", name: "Tesoura de cozinha", description: "Para uso di√°rio na cozinha", link: "https://www.amazon.com.br/s?k=tesoura+cozinha" },
        { id: "utensilios-6", category: "utensilios", icon: "https://m.media-amazon.com/images/I/51QxvD6l7wL._AC_SX679_.jpg", name: "T√°bua de corte", description: "Para preparar alimentos", link: "https://www.amazon.com.br/s?k=tabua+de+corte" },
        { id: "utensilios-7", category: "utensilios", icon: "https://m.media-amazon.com/images/I/41nCEBB7qDL._AC_SX679_.jpg", name: "Ralador", description: "Para queijo, legumes e mais", link: "https://www.amazon.com.br/s?k=ralador+inox" },
        { id: "utensilios-8", category: "utensilios", icon: "https://m.media-amazon.com/images/I/61n8cS5x2kL._AC_SX679_.jpg", name: "Faca de cozinha", description: "Faca multiuso", link: "https://www.amazon.com.br/s?k=faca+cozinha+inox" },
        { id: "utensilios-9", category: "utensilios", icon: "https://m.media-amazon.com/images/I/61U7o6X2yJL._AC_SX679_.jpg", name: "Pegador", description: "Para saladas e alimentos", link: "https://www.amazon.com.br/s?k=pegador+cozinha" },

        // Potes
        { id: "potes-1", category: "potes", icon: "https://m.media-amazon.com/images/I/51G655iyvdL._AC_SL1080_.jpg", name: "Kit 2 Potes de Vidro Herm√©ticos", description: "Para armazenar alimentos", link: "https://a.co/d/gH9mf9o" },
        { id: "potes-2", category: "potes", icon: "https://m.media-amazon.com/images/I/61EoB8+uWBL._AC_SX679_.jpg", name: "Potes pl√°sticos (kit)", description: "Kit com potes para mantimentos", link: "https://www.amazon.com.br/s?k=kit+potes+pl%C3%A1sticos+mantimentos" },
        { id: "potes-3", category: "potes", icon: "https://m.media-amazon.com/images/I/51H0o6qZ4EL._AC_SX679_.jpg", name: "Pote para arroz", description: "Organiza√ß√£o de mantimentos", link: "https://www.amazon.com.br/s?k=pote+para+arroz" },
        { id: "potes-4", category: "potes", icon: "https://m.media-amazon.com/images/I/61j8oC2vS3L._AC_SX679_.jpg", name: "Pote para feij√£o", description: "Organiza√ß√£o de mantimentos", link: "https://www.amazon.com.br/s?k=pote+para+feij%C3%A3o" },
        { id: "potes-5", category: "potes", icon: "https://m.media-amazon.com/images/I/61wB0x9vMML._AC_SX679_.jpg", name: "Pote para a√ß√∫car", description: "Organiza√ß√£o de mantimentos", link: "https://www.amazon.com.br/s?k=pote+para+a%C3%A7%C3%BAcar" },
        { id: "potes-6", category: "potes", icon: "https://m.media-amazon.com/images/I/61yXzqQGg5L._AC_SX679_.jpg", name: "Pote para caf√©", description: "Organiza√ß√£o de mantimentos", link: "https://www.amazon.com.br/s?k=pote+para+caf%C3%A9" },
        { id: "potes-7", category: "potes", icon: "https://m.media-amazon.com/images/I/61E+ZQd8s4L._AC_SX679_.jpg", name: "Pote para farinha", description: "Organiza√ß√£o de mantimentos", link: "https://www.amazon.com.br/s?k=pote+para+farinha" },
        { id: "potes-8", category: "potes", icon: "https://m.media-amazon.com/images/I/61CwDk2f9zL._AC_SX679_.jpg", name: "Potes temperos (kit)", description: "Para organizar temperos", link: "https://www.amazon.com.br/s?k=kit+potes+tempero" },

        // Cozinha
        { id: "cozinha-1", category: "cozinha", icon: "https://m.media-amazon.com/images/I/71y8r5qLk8L._AC_SX679_.jpg", name: "Panela", description: "Item essencial para o dia a dia", link: "https://www.amazon.com.br/s?k=panela" },
        { id: "cozinha-2", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61mE0zGZgLL._AC_SX679_.jpg", name: "Frigideira", description: "Para grelhar e fritar", link: "https://www.amazon.com.br/s?k=frigideira" },
        { id: "cozinha-3", category: "cozinha", icon: "https://m.media-amazon.com/images/I/31TpUxJ4mHL._AC_SX679_.jpg", name: "Coador de caf√© Melitta 103", description: "Caf√© fresquinho todo dia", link: "https://www.amazon.com.br/s?k=coador+cafe+melitta+103" },
        { id: "cozinha-4", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61xYqYx2w0L._AC_SX679_.jpg", name: "Jarra", description: "Para sucos e √°gua", link: "https://www.amazon.com.br/s?k=jarra+vidro" },
        { id: "cozinha-5", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61Hq1Jx5BKL._AC_SX679_.jpg", name: "Escorredor de lou√ßa", description: "Para secar pratos e talheres", link: "https://www.amazon.com.br/s?k=escorredor+de+lou%C3%A7a" },
        { id: "cozinha-6", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61sD8KZpC7L._AC_SX679_.jpg", name: "Jogo de copos", description: "Para servir bebidas", link: "https://www.amazon.com.br/s?k=jogo+de+copos" },
        { id: "cozinha-7", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61XQ1l2h7vL._AC_SX679_.jpg", name: "Jogo de pratos", description: "Para refei√ß√µes", link: "https://www.amazon.com.br/s?k=jogo+de+pratos" },
        { id: "cozinha-8", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61R0g7xqfYL._AC_SX679_.jpg", name: "Talheres (kit)", description: "Kit com talheres", link: "https://www.amazon.com.br/s?k=kit+talheres" },
        { id: "cozinha-9", category: "cozinha", icon: "https://m.media-amazon.com/images/I/61c5wGZ8uCL._AC_SX679_.jpg", name: "Pano de prato (kit)", description: "Para o dia a dia", link: "https://www.amazon.com.br/s?k=kit+pano+de+prato" },

        // Formas
        { id: "formas-1", category: "formas", icon: "https://m.media-amazon.com/images/I/61u8p5aJdEL._AC_SX679_.jpg", name: "Forma de bolo", description: "Para bolos e receitas", link: "https://www.amazon.com.br/s?k=forma+de+bolo" },
        { id: "formas-2", category: "formas", icon: "https://m.media-amazon.com/images/I/61y6oQ7dWqL._AC_SX679_.jpg", name: "Forma de pizza", description: "Para pizzas", link: "https://www.amazon.com.br/s?k=forma+pizza" },
        { id: "formas-3", category: "formas", icon: "https://m.media-amazon.com/images/I/61v6bq9xJxL._AC_SX679_.jpg", name: "Assadeira", description: "Para assar alimentos", link: "https://www.amazon.com.br/s?k=assadeira" },
        { id: "formas-4", category: "formas", icon: "https://m.media-amazon.com/images/I/51h2IHO3cJS._AC_SX679_.jpg", name: "Forma de lasanha de vidro", description: "Vai do forno √† mesa", link: "https://www.amazon.com.br/s?k=forma+lasanha+vidro" },
        { id: "formas-5", category: "formas", icon: "https://m.media-amazon.com/images/I/61yVqHqP3EL._AC_SX679_.jpg", name: "Forma de pudim", description: "Para sobremesas", link: "https://www.amazon.com.br/s?k=forma+pudim" },
        { id: "formas-6", category: "formas", icon: "https://m.media-amazon.com/images/I/61VxgWq7w5L._AC_SX679_.jpg", name: "Forma de cupcake", description: "Para muffins/cupcakes", link: "https://www.amazon.com.br/s?k=forma+cupcake" },

        // Banheiro
        { id: "banheiro-1", category: "banheiro", icon: "https://m.media-amazon.com/images/I/51zNDiujMCL._AC_SY300_SX300_QL70_ML2_.jpg", name: "Saboneteira", description: "Para organizar o sabonete", link: "https://www.amazon.com.br/s?k=saboneteira" },
        { id: "banheiro-2", category: "banheiro", icon: "https://m.media-amazon.com/images/I/61Qd9l2m+5L._AC_SX679_.jpg", name: "Porta escovas", description: "Organiza√ß√£o do banheiro", link: "https://www.amazon.com.br/s?k=porta+escovas+dente" },
        { id: "banheiro-3", category: "banheiro", icon: "https://m.media-amazon.com/images/I/61sYl6oE3xL._AC_SX679_.jpg", name: "Lixeira", description: "Lixeira para banheiro", link: "https://www.amazon.com.br/s?k=lixeira+banheiro" },
        { id: "banheiro-4", category: "banheiro", icon: "https://m.media-amazon.com/images/I/61x8Q3zQqzL._AC_SX679_.jpg", name: "Tapete de banheiro", description: "Conjunto de tapetes", link: "https://www.amazon.com.br/s?k=tapete+banheiro+jogo" },
        { id: "banheiro-5", category: "banheiro", icon: "https://m.media-amazon.com/images/I/61y7g8fK4YL._AC_SX679_.jpg", name: "Toalhas (kit)", description: "Kit de toalhas", link: "https://www.amazon.com.br/s?k=kit+toalhas" },

        // Organiza√ß√£o
        { id: "organizacao-1", category: "organizacao", icon: "https://m.media-amazon.com/images/I/71QBq-o+bZL._AC_SX300_SY300_QL70_ML2_.jpg", name: "Cabides (kit)", description: "Para organizar o guarda-roupa", link: "https://www.amazon.com.br/s?k=cabides+kit" },
        { id: "organizacao-2", category: "organizacao", icon: "https://m.media-amazon.com/images/I/61C7yVQmB0L._AC_SX679_.jpg", name: "Organizador de gaveta", description: "Para dividir e organizar", link: "https://www.amazon.com.br/s?k=organizador+gaveta" },
        { id: "organizacao-3", category: "organizacao", icon: "https://m.media-amazon.com/images/I/61f2pQpYHqL._AC_SX679_.jpg", name: "Cestos organizadores", description: "Para prateleiras e arm√°rios", link: "https://www.amazon.com.br/s?k=cesto+organizador" },
        { id: "organizacao-4", category: "organizacao", icon: "https://m.media-amazon.com/images/I/61gZkzG3v2L._AC_SX679_.jpg", name: "Potes para lavanderia", description: "Para sab√£o/amaciantes", link: "https://www.amazon.com.br/s?k=potes+lavanderia" },
        { id: "organizacao-5", category: "organizacao", icon: "https://m.media-amazon.com/images/I/61mY6p6w0yL._AC_SX679_.jpg", name: "Porta mantas/caixa", description: "Para organizar itens", link: "https://www.amazon.com.br/s?k=caixa+organizadora" }
      ];

    // ============================
    // STATE
    // ============================
    var reservations = [];
    var currentCategory = "all";
    var selectedItem = null;

    // ============================
    // HELPERS ES5
    // ============================
    function $(id){ return document.getElementById(id); }

    function hideDebug(){
      try { $("debug-box").className = "hidden " + $("debug-box").className; } catch(e){}
    }

    function showDebug(message, hint) {
      try {
        $("debug-text").innerHTML = message || "Erro desconhecido";
        $("debug-hint").innerHTML = hint || "";
        $("debug-box").className = $("debug-box").className.replace(" hidden","");
      } catch(e){}
    }

    function showToast(message, type) {
      var container = $("toast-container");
      if (!container) return;
      var toast = document.createElement("div");
      toast.className = "toast px-6 py-3 rounded-full shadow-lg text-white font-medium";
      toast.style.backgroundColor = (type === "success") ? "#6B9B5E" : "#D4A5A5";
      toast.innerHTML = message;
      container.appendChild(toast);
      setTimeout(function(){ try{ container.removeChild(toast); }catch(e){} }, 3000);
    }

    function setSyncStatus(text) {
      var el = $("sync-status");
      if (el) el.innerHTML = text;
    }

    function pad2(n) {
      n = String(n);
      return (n.length < 2) ? ("0" + n) : n;
    }

    function safeText(s) {
      s = String(s || "");
      s = s.replace(/&/g,"&amp;");
      s = s.replace(/</g,"&lt;");
      s = s.replace(/>/g,"&gt;");
      s = s.replace(/"/g,"&quot;");
      s = s.replace(/'/g,"&#039;");
      return s;
    }

    function isImageUrl(u){ return u && String(u).indexOf("http") === 0; }

    function isValidDateBR(s){
      return /^\d{2}\/\d{2}\/\d{4}$/.test(String(s||"").replace(/\s+/g,""));
    }

    function renderIconHtml(item) {
      if (isImageUrl(item.icon)) {
        return '<img src="'+ item.icon +'" alt="'+ safeText(item.name) +'" class="w-20 h-20 object-contain mx-auto rounded-lg" loading="lazy" onerror="this.onerror=null; this.outerHTML=\'<span class=&quot;text-4xl block&quot;>üéÅ</span>\'">';
      }
      return '<span class="text-4xl block">üéÅ</span>';
    }

    // ============================
    // JSONP
    // ============================
    function jsonpRequest(params, onOk, onErr) {
      var cbName = "__cb_" + (new Date().getTime()) + "_" + Math.floor(Math.random()*100000);
      params._ts = new Date().getTime();

      var query = [];
      for (var k in params) {
        if (params.hasOwnProperty(k)) {
          query.push(encodeURIComponent(k) + "=" + encodeURIComponent(String(params[k])));
        }
      }
      query.push("callback=" + encodeURIComponent(cbName));

      var url = APPS_SCRIPT_URL + (APPS_SCRIPT_URL.indexOf("?") >= 0 ? "&" : "?") + query.join("&");

      var done = false;
      var script = document.createElement("script");

      var timer = setTimeout(function(){
        if (done) return;
        done = true;
        cleanup();
        if (onErr) onErr({ message: "Timeout" });
      }, 15000);

      window[cbName] = function(data){
        if (done) return;
        done = true;
        cleanup();
        if (onOk) onOk(data);
      };

      function cleanup() {
        clearTimeout(timer);
        try { window[cbName] = null; } catch(e){}
        try { if (script && script.parentNode) script.parentNode.removeChild(script); } catch(e){}
      }

      script.onerror = function(){
        if (done) return;
        done = true;
        cleanup();
        if (onErr) onErr({ message: "Falha ao carregar JSONP" });
      };

      script.src = url;
      document.body.appendChild(script);
    }

    // ============================
    // RESERVAS
    // ============================
    function isReserved(itemId) {
      for (var i=0; i<reservations.length; i++) {
        if (String(reservations[i].item_id) === String(itemId)) return true;
      }
      return false;
    }

    function getReservation(itemId) {
      for (var i=0; i<reservations.length; i++) {
        if (String(reservations[i].item_id) === String(itemId)) return reservations[i];
      }
      return null;
    }

    function findItemById(itemId){
      for (var i=0; i<giftItems.length; i++){
        if (String(giftItems[i].id) === String(itemId)) return giftItems[i];
      }
      return null;
    }

    // ============================
    // MODAL
    // ============================
    function openModal(itemId){
      var item = findItemById(itemId);
      if (!item) return;

      selectedItem = item;

      $("modal-item-name").innerHTML = safeText(item.name);
      $("modal-item-desc").innerHTML = safeText(item.description || "");
      $("modal-icon").innerHTML = renderIconHtml(item);

      // buy link
      var a = $("modal-buy-link");
      if (item.link) {
        a.href = item.link;
        a.style.display = "inline-flex";
      } else {
        a.href = "#";
        a.style.display = "none";
      }

      // decide reserve vs cancel
      var res = getReservation(item.id);
      if (!res) {
        $("modal-title").innerHTML = "Reservar item";
        $("modal-subtitle").innerHTML = "Preencha seus dados para reservar este presente.";
        $("form-reserve").className = "mt-6";
        $("form-cancel").className = "hidden mt-6";
        $("input-name").value = "";
        $("input-birth").value = "";
      } else {
        $("modal-title").innerHTML = "Cancelar reserva";
        $("modal-subtitle").innerHTML = "Cancelamento √© permitido apenas com a mesma data usada na reserva.";
        $("form-reserve").className = "hidden mt-6";
        $("form-cancel").className = "mt-6";
        $("cancel-who").innerHTML = safeText(res.reserved_by || "algu√©m");
        $("input-cancel-birth").value = "";
      }

      $("modal").className = $("modal").className.replace("hidden","").trim();
    }

    function closeModal(){
      selectedItem = null;
      var m = $("modal");
      if (!m) return;
      if (m.className.indexOf("hidden") === -1) m.className = "hidden " + m.className;
    }

    // ============================
    // ACTIONS RESERVAR / CANCELAR
    // ============================
    function confirmReserve(){
      if (!selectedItem) return;

      var name = String($("input-name").value || "").replace(/^\s+|\s+$/g,"");
      var birth = String($("input-birth").value || "").replace(/\s+/g,"");

      if (!name) { showToast("Digite seu nome.", "error"); return; }
      if (!isValidDateBR(birth)) { showToast("Data inv√°lida. Use DD/MM/AAAA.", "error"); return; }

      $("btn-confirm-reserve").innerHTML = "Reservando...";
      $("btn-confirm-reserve").disabled = true;

      jsonpRequest(
        {
          action: "reserve",
          item_id: selectedItem.id,
          item_name: selectedItem.name,
          reserved_by: name,
          reserved_birthdate: birth
        },
        function(res){
          $("btn-confirm-reserve").innerHTML = "Confirmar reserva";
          $("btn-confirm-reserve").disabled = false;

          if (res && res.ok) {
            showToast("‚úÖ Reservado com sucesso!", "success");
            closeModal();
            fetchReservations(true);
          } else {
            showToast((res && res.message) ? res.message : "N√£o foi poss√≠vel reservar.", "error");
          }
        },
        function(){
          $("btn-confirm-reserve").innerHTML = "Confirmar reserva";
          $("btn-confirm-reserve").disabled = false;
          showToast("Falha de conex√£o ao reservar.", "error");
        }
      );
    }

    function confirmCancel(){
      if (!selectedItem) return;

      var birth = String($("input-cancel-birth").value || "").replace(/\s+/g,"");
      if (!isValidDateBR(birth)) { showToast("Data inv√°lida. Use DD/MM/AAAA.", "error"); return; }

      $("btn-confirm-cancel").innerHTML = "Cancelando...";
      $("btn-confirm-cancel").disabled = true;

      jsonpRequest(
        {
          action: "cancel",
          item_id: selectedItem.id,
          reserved_birthdate: birth
        },
        function(res){
          $("btn-confirm-cancel").innerHTML = "Cancelar reserva";
          $("btn-confirm-cancel").disabled = false;

          if (res && res.ok) {
            showToast("‚úÖ Reserva cancelada!", "success");
            closeModal();
            fetchReservations(true);
          } else {
            showToast((res && res.message) ? res.message : "N√£o foi poss√≠vel cancelar.", "error");
          }
        },
        function(){
          $("btn-confirm-cancel").innerHTML = "Cancelar reserva";
          $("btn-confirm-cancel").disabled = false;
          showToast("Falha de conex√£o ao cancelar.", "error");
        }
      );
    }

    // ============================
    // RENDER GRID
    // ============================
    function renderGiftGrid() {
      var grid = $("gift-grid");
      if (!grid) return;

      var items = [];
      for (var i=0; i<giftItems.length; i++) {
        var it = giftItems[i];
        if (currentCategory === "all" || it.category === currentCategory) {
          items.push(it);
        }
      }

      // ordena: dispon√≠veis primeiro
      var available = [];
      var reserved = [];
      for (var j=0; j<items.length; j++) {
        if (isReserved(items[j].id)) reserved.push(items[j]);
        else available.push(items[j]);
      }
      var sorted = available.concat(reserved);

      var html = "";
      for (var k=0; k<sorted.length; k++) {
        var item = sorted[k];
        var res = getReservation(item.id);
        var r = !!res;

        html += '<div class="card-hover rounded-2xl p-6 border-2 relative overflow-hidden" style="background-color:#fff; border-color:#EDE9E3;">';

        if (r) {
          html += '<div class="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-medium text-white" style="background-color:'+ config.secondary_action_color +'">Reservado</div>';
        } else {
          html += '<div class="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-medium text-white" style="background-color:'+ config.primary_action_color +'">Dispon√≠vel</div>';
        }

        html += '<div class="text-center">';
        html += '<div class="mb-4 flex justify-center items-center" style="min-height:80px;">'+ renderIconHtml(item) +'</div>';
        html += '<h3 class="font-heading text-2xl mb-2" style="color:'+ config.text_color +'">'+ safeText(item.name) +'</h3>';
        html += '<p class="text-base mb-4" style="color:'+ config.secondary_action_color +'">'+ safeText(item.description) +'</p>';

        if (r) {
          html += '<div class="text-sm italic mb-4" style="color:#8b7355">Reservado por '+ safeText(res.reserved_by || "algu√©m") +'</div>';
          html += '<button onclick="openModal(\''+ item.id +'\')" class="w-full px-6 py-3 rounded-full text-white font-medium transition-all hover:shadow-md" style="background-color:'+ config.secondary_action_color +'">Cancelar reserva</button>';
        } else {
          html += '<div class="text-sm mb-4" style="color:#6b9b5e">‚úÖ Clique para reservar</div>';
          html += '<button onclick="openModal(\''+ item.id +'\')" class="w-full px-6 py-3 rounded-full text-white font-medium transition-all hover:shadow-md" style="background-color:'+ config.primary_action_color +'">Reservar</button>';
        }

        html += '</div></div>';
      }

      grid.innerHTML = html;
    }

    function filterCategory(cat) {
      currentCategory = cat;

      var btns = document.getElementsByClassName("category-btn");
      for (var i=0; i<btns.length; i++) {
        var btn = btns[i];
        var c = btn.getAttribute("data-category");
        if (c === cat) {
          btn.style.backgroundColor = config.primary_action_color;
          btn.style.color = "white";
        } else {
          btn.style.backgroundColor = "#EDE9E3";
          btn.style.color = config.text_color;
        }
      }

      renderGiftGrid();
    }

    // ============================
    // RENDER LINKS
    // ============================
    function renderLinksList() {
      var container = $("links-list");
      if (!container) return;

      var cats = {
        utensilios: { title: "ü•Ñ Utens√≠lios de Cozinha", items: [] },
        potes: { title: "ü´ô Potes e Armazenamento", items: [] },
        cozinha: { title: "üç≥ Cozinha Geral", items: [] },
        formas: { title: "üéÇ Formas e Assadeiras", items: [] },
        banheiro: { title: "üõÅ Banheiro", items: [] },
        organizacao: { title: "üß∫ Organiza√ß√£o", items: [] }
      };

      for (var i=0; i<giftItems.length; i++) {
        var it = giftItems[i];
        if (it.link && cats[it.category]) cats[it.category].items.push(it);
      }

      function storeName(link) {
        link = String(link || "");
        if (link.indexOf("amazon") >= 0 || link.indexOf("a.co") >= 0) return "Ver na Amazon";
        if (link.indexOf("mercadolivre") >= 0) return "Ver no Mercado Livre";
        if (link.indexOf("americanas") >= 0) return "Ver nas Americanas";
        return "Ver loja";
      }

      var html = "";
      for (var key in cats) {
        if (!cats.hasOwnProperty(key)) continue;
        var cat = cats[key];
        if (!cat.items.length) continue;

        html += '<div class="mb-8">';
        html += '<h3 class="font-heading text-2xl md:text-3xl mb-4" style="color:'+ config.text_color +'">'+ cat.title +'</h3>';

        for (var j=0; j<cat.items.length; j++) {
          var item = cat.items[j];
          html += '<a href="'+ item.link +'" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-4 rounded-xl transition-all hover:shadow-md" style="background-color:white; border:1px solid #EDE9E3;">';
          html += '<div class="flex items-center gap-3">';
          html += '<div class="w-10 h-10 rounded-lg overflow-hidden flex-shrink-0 bg-gray-100 flex items-center justify-center">';
          html += (isImageUrl(item.icon) ? '<img src="'+ item.icon +'" class="w-full h-full object-contain" loading="lazy" onerror="this.outerHTML=\'üéÅ\'">' : 'üéÅ');
          html += '</div>';
          html += '<span class="font-medium" style="color:'+ config.text_color +'">'+ safeText(item.name) +'</span>';
          html += '</div>';
          html += '<div class="text-sm" style="color:'+ config.primary_action_color +'">'+ storeName(item.link) +'</div>';
          html += '</a>';
        }

        html += '</div>';
      }

      container.innerHTML = html;
    }

    // ============================
    // COUNTDOWN
    // ============================
    function updateCountdown() {
      try {
        var eventDate = new Date("2026-02-08T15:00:00-03:00");
        var now = new Date();
        var diff = eventDate.getTime() - now.getTime();
        if (diff <= 0) diff = 0;

        var days = Math.floor(diff / (1000*60*60*24));
        var hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
        var minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
        var seconds = Math.floor((diff % (1000*60)) / 1000);

        $("countdown-days").innerHTML = String(days);
        $("countdown-hours").innerHTML = pad2(hours);
        $("countdown-minutes").innerHTML = pad2(minutes);
        $("countdown-seconds").innerHTML = pad2(seconds);
      } catch(e) {}
    }

    // ============================
    // FETCH RESERVAS
    // ============================
    function fetchReservations(silent) {
      if (!silent) setSyncStatus("üîÑ Carregando reservas...");

      jsonpRequest(
        { action:"list" },
        function(res) {
          if (res && res.ok) {
            reservations = res.reservations || [];
            renderGiftGrid();
            if (!silent) setSyncStatus("‚úÖ Reservas atualizadas.");
          } else {
            renderGiftGrid();
            if (!silent) setSyncStatus("‚ö†Ô∏è N√£o foi poss√≠vel carregar reservas agora.");
          }
        },
        function() {
          renderGiftGrid();
          if (!silent) setSyncStatus("‚ö†Ô∏è Falha ao carregar reservas.");
        }
      );
    }

    // ============================
    // INIT
    // ============================
    function init() {
      try {
        $("hero-title").innerHTML = config.couple_names;
        $("hero-subtitle").innerHTML = config.event_subtitle;

        renderLinksList();
        filterCategory("all");

        updateCountdown();
        setInterval(updateCountdown, 1000);

        fetchReservations(false);
        setInterval(function(){ fetchReservations(true); }, 25000);

        setSyncStatus("‚úÖ Lista pronta! (reservas atualizando)");
      } catch(e) {
        showDebug(
          "O JavaScript do site falhou ao iniciar. A lista e a contagem podem n√£o aparecer.",
          "Se precisar, me mande um print do Console (F12 > Console)."
        );
      }
    }

    (function(){
      if (document.readyState === "complete" || document.readyState === "interactive") {
        setTimeout(init, 1);
      } else if (document.addEventListener) {
        document.addEventListener("DOMContentLoaded", init);
      } else {
        window.attachEvent && window.attachEvent("onload", init);
      }
    })();
  </script>
</body>
</html>
