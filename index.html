<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ch√° de Casa Nova ‚Äì Juliana & Matheus</title>

  <!-- Sem Tailwind (mais leve e mais compat√≠vel com celular antigo) -->
  <style>
    :root{
      --bg:#FAF8F5;
      --surface:#FFFFFF;
      --text:#5D4E37;
      --muted:#8B7355;
      --primary:#6B9B5E;
      --danger:#D4A5A5;
      --line:#EDE9E3;
      --soft:#F5F2ED;
      --warn:#FFF9E6;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: Arial, Helvetica, sans-serif;
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px; }
    .hero{
      background: radial-gradient(ellipse at 20% 80%, rgba(195,177,160,.3) 0%, transparent 50%),
                  radial-gradient(ellipse at 80% 20%, rgba(168,195,160,.2) 0%, transparent 50%),
                  radial-gradient(ellipse at 50% 50%, rgba(210,180,140,.15) 0%, transparent 70%);
      padding:24px 0 18px;
    }
    .card{
      background:var(--surface); border:1px solid var(--line);
      border-radius:18px; padding:18px;
      box-shadow: 0 10px 30px rgba(93,78,55,.08);
    }
    .title{ font-size:34px; margin:10px 0 6px; }
    .subtitle{ font-size:20px; color:var(--muted); margin:0 0 14px; }
    .pill{
      display:inline-block; padding:6px 12px; border-radius:999px;
      background:rgba(107,155,94,.10); border:1px dashed var(--primary);
      margin:10px 0;
    }
    .btn{
      appearance:none; border:0; cursor:pointer;
      background:var(--primary); color:#fff;
      padding:12px 16px; border-radius:999px;
      font-weight:700; font-size:16px;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .btn.secondary{
      background:#FEE2E2; color:#DC2626; font-weight:700;
    }
    .grid{
      display:grid; grid-template-columns: repeat(1, minmax(0, 1fr));
      gap:12px;
    }
    @media(min-width: 820px){
      .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    .item{
      background:var(--surface); border:2px solid var(--line);
      border-radius:18px; padding:14px; position:relative;
    }
    .item h3{ margin:8px 0 6px; font-size:18px; }
    .item p{ margin:0 0 10px; color:var(--muted); font-size:14px; }
    .tag{
      position:absolute; top:12px; right:12px;
      font-size:12px; color:#fff; background:var(--muted);
      padding:5px 9px; border-radius:999px;
    }
    .by{ font-size:13px; color:var(--muted); font-style:italic; margin:6px 0 10px;}
    .imgbox{
      width:72px; height:72px; border-radius:14px;
      overflow:hidden; background:#f2f2f2;
      display:flex; align-items:center; justify-content:center;
      margin:0 auto;
    }
    .imgbox img{ width:100%; height:100%; object-fit:contain; }
    .section{ padding:18px 0; }
    .soft{ background:var(--soft); padding:18px 0; }
    .notice{
      background:var(--warn); border:1px solid #F5E6B3;
      border-radius:14px; padding:12px; color:#8B6914;
      margin:12px 0;
    }
    .highlight{
      background:var(--warn); border-bottom:2px solid var(--primary);
      padding:2px 6px; border-radius:8px; font-weight:700;
    }

    /* Modal */
    .backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.5);
      display:none; align-items:center; justify-content:center;
      padding:14px; z-index:50;
    }
    .modal{
      width:100%; max-width:520px; max-height:88vh;
      overflow:auto; border-radius:18px; background:#fff;
      padding:16px; position:relative;
      animation: pop .12s ease;
    }
    @keyframes pop{ from{ transform:scale(.98); opacity:.6;} to{transform:scale(1); opacity:1;} }
    .x{
      position:absolute; top:10px; right:10px;
      width:36px; height:36px; border-radius:999px;
      border:0; background:#f3f3f3; cursor:pointer;
      font-size:18px;
    }
    label{ display:block; font-weight:700; margin:12px 0 6px; }
    input{
      width:100%; padding:12px 12px; border-radius:12px;
      border:2px solid var(--line); background:var(--bg);
      font-size:16px;
    }
    .small{ font-size:12px; color:var(--muted); margin-top:6px; }
    .center{ text-align:center; }
    .toast{
      position:fixed; top:14px; left:50%; transform:translateX(-50%);
      background:var(--primary); color:#fff; padding:10px 14px;
      border-radius:999px; font-weight:700; display:none; z-index:99;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      max-width:92vw; text-align:center;
    }
    .toast.error{ background:var(--danger); }
    .steps{
      display:grid; gap:10px;
      grid-template-columns: repeat(1, minmax(0,1fr));
      margin-top:10px;
    }
    @media(min-width:820px){ .steps{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
    .step{
      background:#fff; border:1px solid var(--line);
      border-radius:16px; padding:14px; text-align:center;
    }
    .num{
      width:54px; height:54px; border-radius:999px; margin:0 auto 8px;
      background:var(--primary); color:#fff; display:flex;
      align-items:center; justify-content:center; font-size:26px; font-weight:900;
    }
    footer{ padding:28px 0; text-align:center; color:var(--muted); }
  </style>
</head>

<body>
  <div class="toast" id="toast"></div>

  <div class="hero">
    <div class="wrap">
      <div class="center">
        <div class="pill">üåø Ch√° de Casa Nova</div>
        <h1 class="title">Juliana & Matheus</h1>
        <p class="subtitle"><em>Um novo lar, um novo come√ßo</em></p>

        <div class="card" style="margin-top:12px;">
          <div class="center">
            <div style="letter-spacing:.25em; text-transform:uppercase; font-size:12px; color:var(--primary); font-weight:900;">‚è∞ Faltam</div>
            <div style="font-size:34px; font-weight:900; margin:8px 0;" id="countdown">-- dias --:--:--</div>
            <div style="font-size:18px; font-weight:900;">üìÖ 08 de Fevereiro de 2026 ‚Ä¢ 15h</div>
          </div>
        </div>

        <div class="pill" style="margin-top:12px;">
          üìç <strong>Sal√£o Torre Rubi</strong> ‚Äì Cond. Side Barra Funda ‚Ä¢ Rua do Bosque, 980
        </div>

        <div style="margin-top:14px;">
          <button class="btn" onclick="scrollToList()">Ver Lista de Presentes ‚¨áÔ∏è</button>
        </div>
      </div>
    </div>
  </div>

  <div class="section" style="background:#fff;">
    <div class="wrap center">
      <div style="font-size:34px;">üè†</div>
      <h2 style="margin:8px 0 10px;">Seja bem-vindo(a)!</h2>
      <div style="max-width:860px; margin:0 auto; font-size:18px; line-height:1.5;">
        <p>Estamos muito felizes em compartilhar esse momento especial com voc√™s! Estamos montando nosso primeiro cantinho juntos e preparamos com carinho uma lista de itens que v√£o nos ajudar a transformar essa casa em um verdadeiro lar.</p>
        <p>Sua presen√ßa √© muito importante para n√≥s e far√° esse momento ainda mais especial.</p>
        <p>Para nos ajudar a montar esse novo come√ßo, pedimos que <span class="highlight">cada convidado escolha um item da lista</span>, para que todos possam participar.</p>
        <p>Escolhemos cada item pensando em nosso dia a dia e em criar mem√≥rias felizes nesse novo lar que est√° nascendo. üíö</p>
      </div>
    </div>
  </div>

  <div class="soft">
    <div class="wrap">
      <div class="center">
        <h2 style="margin:0 0 6px;">Como Funciona</h2>
        <p style="margin:0 0 14px; color:var(--muted); font-size:18px;">Simples e f√°cil, sem complica√ß√£o!</p>
      </div>

      <div class="steps">
        <div class="step">
          <div class="num">1</div>
          <h3>Escolha</h3>
          <p style="margin:0; color:var(--muted);">Navegue pela lista e escolha o presente que deseja dar</p>
        </div>
        <div class="step">
          <div class="num">2</div>
          <h3>Reserve</h3>
          <p style="margin:0; color:var(--muted);">Preencha seu nome e data de nascimento para garantir o item</p>
        </div>
        <div class="step">
          <div class="num">3</div>
          <h3>Compre</h3>
          <p style="margin:0; color:var(--muted);">Adquira onde preferir, no seu tempo</p>
        </div>
        <div class="step">
          <div class="num">4</div>
          <h3>Entregue</h3>
          <p style="margin:0; color:var(--muted);">Leve no dia do ch√° e celebre conosco!</p>
        </div>
      </div>
    </div>
  </div>

  <div class="section" id="lista">
    <div class="wrap">
      <div class="center">
        <div style="font-size:34px;">üéÅ</div>
        <h2 style="margin:8px 0 6px;">Lista de Presentes</h2>
        <p style="margin:0; color:var(--muted); font-size:18px;">Clique em um item para reserv√°-lo</p>
      </div>

      <div class="notice" id="loadingBanner">‚è≥ <strong>Carregando a lista...</strong> Aguarde alguns segundos para reservar.</div>

      <div class="card" style="margin-top:12px;">
        <div class="grid" id="grid"></div>
      </div>
    </div>
  </div>

  <footer>
    <div class="wrap">
      <div style="font-size:40px;">üíö</div>
      <div style="font-size:18px; margin-top:8px;">Obrigado por fazer parte desse momento t√£o especial. Cada gesto de carinho significa muito para n√≥s!</div>
      <div style="margin-top:8px; font-weight:900; color:var(--text); font-size:20px;">Juliana & Matheus</div>
      <div style="margin-top:8px; opacity:.7;">üåø üè† üíö</div>
    </div>
  </footer>

  <!-- MODAL RESERVA -->
  <div class="backdrop" id="reserveBackdrop">
    <div class="modal">
      <button class="x" onclick="closeReserve()">‚úï</button>
      <div class="center">
        <div id="reserveIcon" style="font-size:44px; margin-top:4px;">üéÅ</div>
        <h3 id="reserveTitle" style="margin:8px 0 4px;">Nome do Presente</h3>
        <div id="reserveDesc" style="color:var(--muted); margin-bottom:6px;">Descri√ß√£o</div>
      </div>

      <form onsubmit="submitReserve(event)">
        <input type="hidden" id="reserveItemId"/>
        <input type="hidden" id="reserveItemName"/>

        <label>Seu Nome</label>
        <input id="guestName" required placeholder="Como voc√™ se chama?"/>

        <label>Sua Data de Nascimento</label>
        <input id="guestBirth" required placeholder="DD/MM/AAAA" maxlength="10" inputmode="numeric" oninput="formatDate(this)"/>
        <div class="small">üîí Usada para confirmar sua identidade ao cancelar</div>

        <div style="margin-top:14px;">
          <button class="btn" id="reserveBtn" type="submit">Reservar Presente</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL CONFIRMA√á√ÉO FOFA -->
  <div class="backdrop" id="okBackdrop">
    <div class="modal">
      <button class="x" onclick="closeOk()">‚úï</button>

      <div class="center">
        <div style="font-size:56px;">üéâ</div>
        <h2 style="margin:6px 0 8px;">Presente Reservado!</h2>
        <div style="font-size:26px;">‚ù§Ô∏è üè† üòä</div>

        <div class="card" style="margin-top:14px; background:var(--soft);">
          <div style="font-size:18px; line-height:1.4;">
            <div style="font-weight:900; font-size:22px; margin-bottom:8px;" id="okName">Querido(a)</div>
            Muito obrigado por fazer parte desse dia t√£o especial nas nossas vidas! ‚ù§Ô∏è
          </div>

          <div class="card" style="margin-top:12px; border:2px dashed var(--primary);">
            <div style="color:var(--muted); font-weight:900;">üéÅ Voc√™ reservou:</div>
            <div id="okItem" style="font-size:22px; font-weight:900; margin-top:6px;">Item</div>
          </div>

          <p style="margin:12px 0; color:var(--text);">
            Este item agora est√° <strong style="color:var(--primary);">bloqueado</strong> e reservado especialmente em seu nome! üè†
            Ningu√©m mais poder√° escolh√™-lo.
          </p>

          <div class="notice">
            ‚ö†Ô∏è <strong>Lembrete importante:</strong> Por favor, n√£o se esque√ßa de levar o presente no dia do nosso Ch√° de Casa Nova!
            Estamos super ansiosos para celebrar com voc√™! üòä‚ù§Ô∏è
          </div>

          <div class="card" style="border:1px solid #A8C3A0; background:#E8F5E9;">
            üéÅ <strong>Surpresa especial!</strong> Seu nome ser√° inclu√≠do no nosso <strong>sorteio especial</strong> e confirmado no dia,
            ap√≥s a entrega do presente! üçÄ‚ù§Ô∏è
          </div>
        </div>

        <button class="btn" style="margin-top:12px;" onclick="closeOk()">Fechar e Voltar √† Lista</button>
      </div>
    </div>
  </div>

  <!-- MODAL CANCELAMENTO -->
  <div class="backdrop" id="cancelBackdrop">
    <div class="modal">
      <button class="x" onclick="closeCancel()">‚úï</button>

      <div class="center">
        <div style="font-size:46px;">üò¢</div>
        <h2 style="margin:6px 0 10px;" id="cancelTitle">Cancelar Reserva</h2>
        <div style="color:var(--muted); margin-bottom:8px;">Para cancelar sua reserva, confirme seus dados:</div>
      </div>

      <form onsubmit="submitCancel(event)">
        <input type="hidden" id="cancelItemId"/>

        <label>Data de nascimento usada na reserva</label>
        <input id="cancelBirth" required placeholder="DD/MM/AAAA" maxlength="10" inputmode="numeric" oninput="formatDate(this)"/>

        <div class="small" style="text-align:center; margin-top:10px;">
          ‚ö†Ô∏è Ao cancelar, o item ficar√° dispon√≠vel para outros convidados
        </div>

        <div style="display:flex; gap:10px; margin-top:14px;">
          <button type="button" class="btn" style="flex:1; background:var(--line); color:var(--text);" onclick="closeCancel()">Voltar</button>
          <button type="submit" class="btn secondary" id="cancelBtn" style="flex:1;">Cancelar Reserva</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ‚úÖ SUA URL DO APPS SCRIPT (a nova)
    const API_URL = "https://script.google.com/macros/s/AKfycbxmMyWFTWrHzj39YImVblKvDoSwEqUTeLN21i3sEaAAO4wjsW1RUEBH88g7aV_IL920BQ/exec";

    // LISTA DE ITENS (voc√™ pode trocar depois com os seus itens reais)
    // Para cada item: id, name, description, iconUrl (opcional)
    const giftItems = [
      { id:"utensilios-4", name:"Escorredor de Massa", description:"Para escorrer massas com praticidade", iconUrl:"" },
      { id:"utensilios-13", name:"Pegador de sorvete em inox", description:"Bolas de sorvete perfeitas", iconUrl:"" },
      { id:"cozinha-1", name:"Jarra de vidro", description:"Para sucos e bebidas", iconUrl:"" },
      { id:"formas-1", name:"Forma de bolo redonda", description:"Para bolos tradicionais", iconUrl:"" },
      { id:"banheiro-1", name:"Saboneteira", description:"Para organizar o sabonete", iconUrl:"" },
      { id:"organizacao-1", name:"Cabides (kit)", description:"Para organizar o guarda-roupa", iconUrl:"" }
    ];

    let reservations = []; // vem do Sheets

    // ======= Helpers (compat√≠veis com celular antigo) =======
    function showToast(msg, type){
      const t = document.getElementById("toast");
      t.className = "toast" + (type === "error" ? " error" : "");
      t.textContent = msg;
      t.style.display = "block";
      setTimeout(function(){ t.style.display = "none"; }, 2800);
    }

    function formatDate(input){
      let v = (input.value || "").replace(/\D/g, "");
      if(v.length >= 2) v = v.substring(0,2) + "/" + v.substring(2);
      if(v.length >= 5) v = v.substring(0,5) + "/" + v.substring(5,9);
      input.value = v;
    }

    function isValidDateBR(s){
      const m = /^(\d{2})\/(\d{2})\/(\d{4})$/.exec(s);
      if(!m) return false;
      const d = parseInt(m[1],10), mo = parseInt(m[2],10), y = parseInt(m[3],10);
      if(mo < 1 || mo > 12) return false;
      if(d < 1 || d > 31) return false;
      if(y < 1900 || y > 2100) return false;
      return true;
    }

    // JSONP (evita CORS e funciona at√© em Android antigo)
    function jsonp(params){
      return new Promise(function(resolve, reject){
        const cb = "cb_" + Date.now() + "_" + Math.floor(Math.random()*100000);
        window[cb] = function(data){
          try { delete window[cb]; } catch(e){ window[cb] = undefined; }
          script.parentNode && script.parentNode.removeChild(script);
          resolve(data);
        };
        const script = document.createElement("script");
        const url = API_URL + (API_URL.indexOf("?")>-1 ? "&" : "?") + params + "&callback=" + cb;
        script.src = url;
        script.onerror = function(){
          try { delete window[cb]; } catch(e){ window[cb] = undefined; }
          script.parentNode && script.parentNode.removeChild(script);
          reject(new Error("JSONP failed"));
        };
        document.body.appendChild(script);
      });
    }

    function scrollToList(){
      const el = document.getElementById("lista");
      if(el && el.scrollIntoView) el.scrollIntoView({behavior:"smooth"});
    }

    // ======= Render =======
    function render(){
      const grid = document.getElementById("grid");
      if(!grid) return;

      // Ordena: dispon√≠veis primeiro, reservados por √∫ltimo
      const available = [];
      const reserved = [];
      for(let i=0;i<giftItems.length;i++){
        const it = giftItems[i];
        const r = findReservation(it.id);
        if(r) reserved.push(it);
        else available.push(it);
      }
      const items = available.concat(reserved);

      let html = "";
      for(let i=0;i<items.length;i++){
        const it = items[i];
        const r = findReservation(it.id);
        const isRes = !!r;

        html += '<div class="item">';
        if(isRes) html += '<div class="tag">Reservado</div>';

        html += '<div class="center">';
        html += '<div class="imgbox">';
        if(it.iconUrl){
          html += '<img src="'+escapeHtml(it.iconUrl)+'" alt="'+escapeHtml(it.name)+'" onerror="this.style.display=\'none\'; this.parentNode.innerHTML=\'üéÅ\';"/>';
        } else {
          html += 'üéÅ';
        }
        html += '</div>';

        html += '<h3>'+escapeHtml(it.name)+'</h3>';
        html += '<p>'+escapeHtml(it.description||"")+'</p>';

        if(isRes){
          html += '<div class="by">Reservado por '+escapeHtml(r.reserved_by||"")+'</div>';
          html += '<button class="btn secondary" onclick="openCancel(\''+escapeAttr(it.id)+'\', \''+escapeAttr(it.name)+'\')">Cancelar Reserva</button>';
        } else {
          html += '<button class="btn" onclick="openReserve(\''+escapeAttr(it.id)+'\', \''+escapeAttr(it.name)+'\', \''+escapeAttr(it.description||"")+'\')">Quero Presentear</button>';
        }

        html += '</div></div>';
      }

      grid.innerHTML = html;
    }

    function escapeHtml(s){
      s = String(s||"");
      return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }
    function escapeAttr(s){
      return escapeHtml(s).replace(/\n/g," ");
    }

    function findReservation(itemId){
      for(let i=0;i<reservations.length;i++){
        if(String(reservations[i].item_id) === String(itemId) && reservations[i].status === "reserved"){
          return reservations[i];
        }
      }
      return null;
    }

    // ======= Modais =======
    function openReserve(id, name, desc){
      document.getElementById("reserveItemId").value = id;
      document.getElementById("reserveItemName").value = name;
      document.getElementById("reserveTitle").textContent = name;
      document.getElementById("reserveDesc").textContent = desc || "";
      document.getElementById("guestName").value = "";
      document.getElementById("guestBirth").value = "";
      document.getElementById("reserveBackdrop").style.display = "flex";
    }
    function closeReserve(){ document.getElementById("reserveBackdrop").style.display = "none"; }

    function openOk(guestName, itemName){
      document.getElementById("okName").textContent = guestName;
      document.getElementById("okItem").textContent = itemName;
      document.getElementById("okBackdrop").style.display = "flex";
    }
    function closeOk(){ document.getElementById("okBackdrop").style.display = "none"; }

    function openCancel(id, name){
      document.getElementById("cancelItemId").value = id;
      document.getElementById("cancelTitle").textContent = "Cancelar: " + name;
      document.getElementById("cancelBirth").value = "";
      document.getElementById("cancelBackdrop").style.display = "flex";
    }
    function closeCancel(){ document.getElementById("cancelBackdrop").style.display = "none"; }

    // ======= A√ß√µes =======
    async function loadReservations(){
      document.getElementById("loadingBanner").style.display = "block";
      try{
        const res = await jsonp("action=list");
        if(res && res.ok){
          reservations = res.reservations || [];
          document.getElementById("loadingBanner").style.display = "none";
          render();
        } else {
          document.getElementById("loadingBanner").style.display = "block";
          showToast("Erro ao carregar. Recarregue a p√°gina.", "error");
        }
      } catch(e){
        document.getElementById("loadingBanner").style.display = "block";
        showToast("Sem conex√£o com o sistema. Recarregue a p√°gina.", "error");
      }
    }

    async function submitReserve(ev){
      ev.preventDefault();

      const btn = document.getElementById("reserveBtn");
      btn.disabled = true;

      const itemId = document.getElementById("reserveItemId").value;
      const itemName = document.getElementById("reserveItemName").value;
      const name = (document.getElementById("guestName").value || "").trim();
      const birth = (document.getElementById("guestBirth").value || "").trim();

      if(!name || !birth){
        btn.disabled = false;
        return showToast("Por favor, preencha todos os campos", "error");
      }
      if(!isValidDateBR(birth)){
        btn.disabled = false;
        return showToast("Data inv√°lida. Use DD/MM/AAAA", "error");
      }
      if(findReservation(itemId)){
        btn.disabled = false;
        closeReserve();
        return showToast("Este item j√° foi reservado", "error");
      }

      try{
        const params =
          "action=reserve" +
          "&item_id=" + encodeURIComponent(itemId) +
          "&item_name=" + encodeURIComponent(itemName) +
          "&reserved_by=" + encodeURIComponent(name) +
          "&reserved_birthdate=" + encodeURIComponent(birth);

        const res = await jsonp(params);

        if(res && res.ok){
          closeReserve();
          await loadReservations();
          openOk(name, itemName);
        } else {
          showToast((res && res.message) ? res.message : "N√£o foi poss√≠vel reservar. Tente novamente.", "error");
        }
      } catch(e){
        showToast("Erro ao processar. Tente novamente.", "error");
      } finally{
        btn.disabled = false;
      }
    }

    async function submitCancel(ev){
      ev.preventDefault();

      const btn = document.getElementById("cancelBtn");
      btn.disabled = true;

      const itemId = document.getElementById("cancelItemId").value;
      const birth = (document.getElementById("cancelBirth").value || "").trim();

      if(!birth){
        btn.disabled = false;
        return showToast("Por favor, informe a data de nascimento", "error");
      }
      if(!isValidDateBR(birth)){
        btn.disabled = false;
        return showToast("Data inv√°lida. Use DD/MM/AAAA", "error");
      }

      // valida√ß√£o local r√°pida
      const r = findReservation(itemId);
      if(!r){
        btn.disabled = false;
        closeCancel();
        return showToast("Reserva n√£o encontrada", "error");
      }

      try{
        const params =
          "action=cancel" +
          "&item_id=" + encodeURIComponent(itemId) +
          "&reserved_birthdate=" + encodeURIComponent(birth);

        const res = await jsonp(params);
        if(res && res.ok){
          closeCancel();
          await loadReservations();
          showToast("Reserva cancelada com sucesso! üíö", "success");
        } else {
          showToast((res && res.message) ? res.message : "Erro ao cancelar. Tente novamente.", "error");
        }
      } catch(e){
        showToast("Erro ao cancelar. Tente novamente.", "error");
      } finally{
        btn.disabled = false;
      }
    }

    // ======= Countdown =======
    function updateCountdown(){
      // 08/02/2026 15:00 (S√£o Paulo = UTC-3)
      const eventDate = new Date("2026-02-08T18:00:00Z");
      const now = new Date();
      const diff = eventDate - now;

      if(diff <= 0){
        document.getElementById("countdown").textContent = "0 dias 00:00:00";
        return;
      }
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const mins = Math.floor((diff % (1000*60*60)) / (1000*60));
      const secs = Math.floor((diff % (1000*60)) / 1000);
      document.getElementById("countdown").textContent =
        days + " dias " +
        String(hours).padStart(2,"0") + ":" +
        String(mins).padStart(2,"0") + ":" +
        String(secs).padStart(2,"0");
    }

    // Init
    updateCountdown();
    setInterval(updateCountdown, 1000);
    loadReservations();
  </script>
</body>
</html>
